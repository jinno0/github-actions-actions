# SYSTEM_CONSTITUTION.md

**永続不変のプロジェクト憲法 - 本リポジトリの存在意義と進化の指針**

---

## 核心的使命（Core Mission）

組織全体の GitHub Actions ワークフローで使用する**共通 Composite Actions** の信頼できる唯一のソースを提供する。

---

## 非目標（Anti-Goals）

### 明確に除外するもの

1. **再利用可能 Workflow テンプレート**
   - これは `github-actions-templates` リポジトリの責務
   - Workflow レベルの抽象化は含まない

2. **アプリケーション固有の CI/CD**
   - 特定のアプリケーションに依存する設定を含めない
   - 汎用的で再利用可能な Action のみを提供

3. **Runner 管理**
   - Runner セットアップスクリプトは `github-actions-hub` の責務
   - このリポジトリは Runner に依存しない設計にする

4. **非 Composite Action**
   - Docker container actions, JavaScript actions は含まない
   - Composite Actions のみに焦点を当てる

---

## 不変の原則（Immutable Principles）

### 1. 単一責任

各 Action は**1つの明確な目的**のみを果たす。

- ❌ 複数の責務を持たない（例: セットアップ＋テスト＋デプロイ）
- ✅ 単一の責務に焦点を当てる（例: Node.js セットアップ、Slack 通知）

### 2. 組織横断的再利用性

すべての Action は**組織内のどのリポジトリからでも**使用可能である必要がある。

- 特定のリポジトリ構造に依存しない
- 必要な入力は `inputs` で明示的に受け取る
- Secret は呼び出し元から渡す設計にする

### 3. バージョン固定

Action のバージョン管理を厳格に行う。

- タグ (`v1`, `v2`) でバージョンを管理
- 破壊的変更がある場合はメジャーバージョンを上げる
- `@main` は使用しない（安定性のため）

### 4. セキュリティ最優先

秘匿情報や安全でない操作を扱わない。

- ❌ トークン、パスワード、秘密鍵をコードに含めない
- ✅ 必要な Secret は呼び出し元から受け取る
- ✅ 入力値のバリデーションを行う
- ✅ 第三者スクリプトの実行は慎重に検証

### 5. ドキュメント駆動

すべての Action は自己文書化されている必要がある。

- `action.yml` に `description` を必須
- 各 `input` に説明を含める
- `outputs` を明確に定義
- 使用例を `README.md` またはコメントに含める

---

## 成功条件（Success Criteria）

### 技術的指標

1. **利用可能性**: 組織内のどのリポジトリからでも `uses:` で呼び出せる
2. **テスト可能性**: 各 Action はスタンドアロンでテスト可能
3. **バージョン管理**: セマンティックバージョニングに従う

### 品質指標

1. **ドキュメント率**: 100%の Action が説明文を持つ
2. **エラー処理**: 失敗時は明確なエラーメッセージを出力
3. **一貫性**: すべての Action が統一された命名規則に従う

---

## 変更のルール（Rules of Evolution）

### 許可される変更

- ✅ バグ修正
- ✅ 新しい Action の追加
- ✅ 非破壊的な機能追加
- ✅ ドキュメントの改善

### 禁止される変更

- ❌ 既存 Action の `inputs` の削除（破壊的変更）
- ❌ 既存 Action の動作変更（非互換性）
- ❌ 組織固有のロジックのハードコーディング

### 破壊的変更を行う場合

どうしても破壊的変更が必要な場合は：

1. 新しいメジャーバージョン (`v2`) を作成
2. 少なくとも1つのマイナーバージョン期間、旧バージョンを維持
3. 移行ガイドを提供

---

## 役割分担（Responsibility）

### このリポジトリ

- **Composite Actions の実装**
- **Action 単位のテスト**
- **Action のバージョン管理**

### github-actions-hub

- **Action の設計方針**
- **使用ドキュメント**
- **どの Action をどのリポから使うかの参照**

### github-actions-templates

- **再利用可能 Workflow テンプレート**
- **ワークフローレベルの抽象化**

---

## 定義（Definitions）

### Composite Action とは

複数のステップを組み合わせて、1つの再利用可能な Action として定義したもの。

```yaml
name: 'My Action'
description: 'What this action does'
runs:
  using: 'composite'
  steps:
    - run: echo 'Hello'
      shell: bash
```

### このリポジトリが提供するもの

- **言語/ランタイムセットアップ**: Node.js, Python, Rust など
- **通知**: Slack, Email など
- **ユーティリティ**: キャッシュ管理、ログ収集など

### このリポジトリが提供しないもの

- **テストフレームワーク**: Jest, pytest などの設定はアプリケーションごと
- **デプロイツール**: 特定のインフラに依存するデプロイは含まない
- **Runner 管理**: セットアップは github-actions-hub で管理

---

**この文書は変更されません。実装詳細は進化しても、これらの原則は永続します。**
