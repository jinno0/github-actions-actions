version: "2.0"
updated_at: "2026-02-07T00:00:00Z"
updated_by: "audit-run-001"

# === Mission ===
mission:
  target_user: "GitHub組織の開発チームとDevOpsエンジニア"
  provided_value: "Claude Code CLIを活用したAIネイティブなGitHub Actionsを提供し、開発効率とコード品質を向上させる"
  desired_state: "組織内の複数リポジトリでAI Actionsが採用され、人間が本質的な設計・意思決定に集中できる状態"

# === Assumptions ===
assumptions:
  - id: "ASM-001"
    field: "mission.target_user"
    value: "Self-hosted GitHub Actions環境を運営する組織"
    reason: "README.mdがself-hosted runnerとClaude Code CLIを前提としている"
    confidence: "high"

  - id: "ASM-002"
    field: "quality_attributes.test_coverage"
    value: ">= 70%"
    reason: "Pythonベースのアクションとテストディレクトリ構造から推測（一般的なOSS基準）"
    confidence: "medium"

  - id: "ASM-003"
    field: "quality_attributes.documentation_coverage"
    value: "100%（全ActionにREADMEとInstruction必須）"
    reason: "README.mdとAGENTS.mdがドキュメント重視を明記している"
    confidence: "high"

  - id: "ASM-004"
    field: "constraints.security"
    value: "PII/機密情報を収集しないテレメトリー"
    reason: "README.mdがプライバシー機能（オプトアウト、匿名化、SHA-256ハッシュ）を明記"
    confidence: "high"

  - id: "ASM-005"
    field: "quality_attributes.ai_review_acceptance_rate"
    value: ">= 70%"
    reason: "README.mdが目標受入率として記載"
    confidence: "high"

# === Core Functions（このリポジトリの存在意義を直接検証する機能）===
core_functions:
  - id: "CF-001"
    claim: "13種類のAI Actionsを提供している"
    source: "README.md:8"
    testable: true
    verification_method: "actions/ディレクトリ以下のaction.ymlファイル数をカウント"

  - id: "CF-002"
    claim: "全Actionに対してExample WorkflowとInstruction Guideを提供している"
    source: "README.md:50-56"
    testable: true
    verification_method: "examples/とinstructions/のファイル数がactions/と一致するか確認"

  - id: "CF-003"
    claim: "Claude Code CLIを活用した文脈理解レビューが可能"
    source: "README.md:4, PURPOSE.md:31-32"
    testable: true
    verification_method: "review-and-merge ActionのテンプレートがClaude Code CLIを正しく呼び出しているか検証"

  - id: "CF-004"
    claim: "カスタムレビュールールを注入可能"
    source: "README.md:66-70, ACTIONS.md:30-33"
    testable: true
    verification_method: "examples/custom-rules/以下のルールファイルが正しく動作するか検証"

  - id: "CF-005"
    claim: "Dry Runモードによる自動検証が可能"
    source: "README.md:94, AGENTS.md"
    testable: true
    verification_method: ".github/workflows/test-with-dry-run.ymlが実行可能か検証"

  - id: "CF-006"
    claim: "プライバシーを考慮したテレメトリー収集"
    source: "README.md:100-119"
    testable: true
    verification_method: "テレメトリー収集スクリプトがオプトアウトと匿名化を実装しているか検証"

  - id: "CF-007"
    claim: "AIレビュー品質メトリクス（受入率）の追跡"
    source: "README.md:122-139"
    testable: true
    verification_method: "scripts/calculate_acceptance_rate.pyが実行可能か検証"

# === Quality Attributes ===
quality_attributes:
  - id: "QA-001"
    name: "テストカバレッジ"
    target: ">= 70%"
    verification:
      type: "measurement"
      command: "pytest --cov=actions --cov=scripts --cov-fail-under=70"
      criteria:
        operator: ">="
        value: 70
        unit: "%"
      interpretation:
        success_means: "コードの70%以上がテストで実行され、主要な機能が保護されている"
        failure_means: "テストされていないコードパスが30%以上あり、バグリスクが高い"
        warning: "カバレッジが高くてもアサーションが弱ければ意味がない"

  - id: "QA-002"
    name: "ドキュメントカバレッジ"
    target: "100% (全ActionにREADMEとInstruction必須)"
    verification:
      type: "structural_check"
      command: |
        for action in actions/*/; do
          if [ ! -f "$action/README.md" ]; then echo "Missing: $action/README.md"; exit 1; fi
          if [ ! -f "instructions/$(basename $action).md" ]; then echo "Missing: instructions/$(basename $action).md"; exit 1; fi
        done
      criteria:
        operator: "=="
        value: 100
        unit: "%"
      interpretation:
        success_means: "全Actionが利用可能な状態で、ユーザーが導入方法を理解できる"
        failure_means: "一部Actionの使い方が不明で、導入障壁が高い"

  - id: "QA-003"
    name: "YAML構文妥当性"
    target: "100% (全action.ymlがパース可能)"
    verification:
      type: "structural_check"
      command: |
        for action in actions/*/action.yml; do
          if ! yamllint "$action" >/dev/null 2>&1; then
            echo "Invalid YAML: $action"
            exit 1
          fi
        done
      criteria:
        operator: "=="
        value: 100
        unit: "%"
      interpretation:
        success_means: "全ActionがGitHub Actionsで実行可能"
        failure_means: "Action定義に構文エラーがあり、実行時に失敗する"

  - id: "QA-004"
    name: "AIレビュー受入率"
    target: ">= 70%"
    verification:
      type: "measurement"
      command: "python scripts/calculate_acceptance_rate.py --time-period 30d"
      criteria:
        operator: ">="
        value: 70
        unit: "%"
      interpretation:
        success_means: "AIレビューが実用的で、開発者に信頼されている"
        failure_means: "AIレビューの品質が低く、修正や拒否が多い"

  - id: "QA-005"
    name: "テレメトリープライバシー"
    target: "オプトアウト可能 & 匿名化実装済み"
    verification:
      type: "code_inspection"
      command: "grep -r 'DISABLE_TELEMETRY\\|sha256\\|hashlib' scripts/collect_metrics.py actions/"
      criteria:
        operator: "contains"
        value: ["DISABLE_TELEMETRY", "sha256", "hashlib"]
      interpretation:
        success_means: "プライバシー機能が実装されており、ユーザーがデータ収集を制御できる"
        failure_means: "プライバシー機能が未実装で、機密情報漏洩リスクがある"

# === Non-Goals ===
non_goals:
  - "単なるシェルスクリプトのラッパー（既存のActionsで十分なもの）"
  - "完全に無人での運用（AIのハルシネーションリスクを考慮）"
  - "特定プロダクトに強く結合しすぎたロジック（再利用性を重視）"
