version: "2.0"
updated_at: "2026-02-04T09:21:00Z"
updated_by: "audit-run-001"

# === 技術的制約 ===
technical:
  runtime:
    - "Self-hosted Runner上で動作すること"
    - "Claude Code CLIがインストールされていること"
    - "Ubuntu 20.04+ または同等のLinux環境であること"

  permissions:
    - "contents:write - コミット作成のため"
    - "pull-requests:write - PR操作のため"
    - "issues:write - コメント投稿のため"

  dependencies:
    - "Python 3.8+"
    - "Node.js 16+（一部のActions）"
    - "gh CLI（オプション）"

# === 運用制約 ===
operational:
  human_in_loop:
    required: true
    description: "AIはあくまで提案・準備を行い、最終決定権（マージ、デプロイ）は人間が持つ、または人間が設定した閾値に基づく"
    reason: "AIのハルシネーションリスクを考慮"

  cost_consideration:
    max_execution_time: "30 minutes per action"
    reason: "長時間の実行はコスト増とUX低下につながる"

  privacy:
    data_handling: "local_only"
    description: "コードやログは外部に送信しない（Claude APIへの送信を除く）"
    telemetry: "オプトアウト可能"

# === セキュリティ制約 ===
security:
  path_validation:
    required: true
    description: "ファイルパスの指定には厳格なバリデーションが必要"
    reason: "パストラバーサル攻撃の防止"

  secret_handling:
    forbidden:
      - "ログへのシークレット出力"
      - "エラーメッセージへの機密情報含"
    required:
      - "GitHub Secretsを使用"
      - "シークレットは環境経由で渡す"

  external_communication:
    allowed:
      - "Claude APIへのリクエスト（AI処理のため）"
      - "GitHub APIへのリクエスト（PR/Issue操作のため）"
    forbidden:
      - "不明な外部APIへの通信"
      - "ユーザーデータの外部送信"

# === 品質制約 ===
quality:
  testing:
    required_coverage: 70
    test_types:
      - "unit（単体テスト）"
      - "integration（統合テスト）"
      - "dry_run（Dry Run検証）"

  documentation:
    required_for:
      - "全てのActions（README.md）"
      - "全てのActions（Setup Guide in instructions/）"
      - "全てのInputs/Outputs（action.yml内）"

  code_review:
    ai_review_acceptance_rate:
      minimum: 70
      unit: "%"
      reason: "AIレビューが有効であることを示す指標"

# === プロジェクト固有制約 ===
project_specific:
  action_structure:
    required_components:
      - "action.yml（メタデータ）"
      - "README.md（ドキュメント）"
      - "scripts/（実装）"
      - "tests/（テスト）"

  reusability:
    max_customization: "中程度"
    description: "プロジェクト固有のロジックはカスタムルール/テンプレートで注入可能にする"
    reason: "特定プロダクトに強く結合しすぎたロジックは避ける（Non-Goals）"

  telemetry:
    collection_enabled: true
    opt_out_available: true
    anonymized: true
    data_types:
      - "Action名"
      - "実行ステータス"
      - "実行時間"
      - "Runner OS"
      - "Claude CLIバージョン"
      - "エラーメッセージ（最大200文字）"

# === 優先順位 ===
priority:
  safety_first:
    - "セキュリティ（パス検証、シークレット管理）"
    - "データプライバシー（外部送信の制限）"

  quality_second:
    - "テストカバレッジ（>= 70%）"
    - "ドキュメント網羅性（100%）"

  functionality_third:
    - "AIレビュー品質（受入率 >= 70%）"
    - "自動化機能の正確性"

# === 成功条件 ===
success_criteria:
  adoption:
    - "組織内の複数のリポジトリで採用される"
    - "AIに任せられる雑務が増える"

  quality:
    - "AIレビューの受入率が向上し続ける"
    - "テストカバレッジが70%以上を維持"

  developer_experience:
    - "ドキュメントが整備されており、導入が容易"
    - "Dry Run検証により安心して導入できる"
