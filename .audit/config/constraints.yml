version: "2.0"
updated_at: "2026-02-07T03:00:00Z"

# === Technical Constraints ===
technical:
  runtime_environment:
    - "Self-hosted GitHub Actions Runner"
    - "Ubuntu 20.04+ (推奨)"
    - "Python 3.8+"
    - "Node.js 16+ (オプション)"

  required_dependencies:
    - name: "Claude Code CLI"
      version: "latest"
      source: "npm install -g @anthropic-ai/claude-code-cli"
      criticality: "critical"

  github_permissions:
    - scope: "contents:write"
      reason: "Actionがコードをコミット・修正するため"
    - scope: "pull-requests:write"
      reason: "PRへのコメントや更新を行うため"
    - scope: "issues:write"
      reason: "Issueへのコメントやメトリクス報告を行うため"

# === Operational Constraints ===
operational:
  human_in_the_loop:
    required: true
    reason: "AIのハルシネーションリスクを軽減し、最終決定権を人間が保持"
    approval_threshold:
      review_merge: "confidence >= 8/10 で自動マージ可能"
      spec_to_code: "必ず人間がレビュー後にマージ"

  cost_considerations:
    - "Self-hosted runnerの維持コスト"
    - "Claude APIの使用コスト（Claude Code CLI経由）"
    - "テレメトリー処理のストレージコスト"

  privacy_requirements:
    telemetry:
      enabled_by_default: true
      opt_out_available: true
      anonymization: "SHA-256ハッシュ（先頭16文字）"
      data_collected:
        - "Action名"
        - "実行ステータス"
        - "実行時間"
        - "Runner OS"
        - "Claude CLIバージョン"
        - "エラーメッセージ（最大200文字）"
      data_not_collected:
        - "コード内容"
        - "機密情報"
        - "個人を特定できる情報"

# === Quality Constraints ===
quality:
  test_coverage:
    target: ">= 70%"
    enforced_in_ci: true
    fail_action_if_below: true

  acceptance_rate:
    target: ">= 70%"
    measurement_period: "7 days"
    status: "baseline_establishment"  # ベースライン策定中

  documentation_requirements:
    required_for_all_actions:
      - "README.md（Actionの説明）"
      - "instructions/*.md（導入ガイド）"
      - "examples/*.yml（利用例）"
      - "action.yml（メタデータ）"

# === Security Constraints ===
security:
  path_validation:
    required: true
    reason: "パストラバーサル攻撃を防止"
    implementation: "全Actionで入力パスの検証を実施"

  secret_handling:
    policy: "シークレットはGitHub Secrets経由で渡し、ログには出力しない"

  code_execution:
    sandboxing: "self-hosted runner上での実行を前提に、適切な分離を確保"
    review_required: "生成コードは必ず人間がレビュー"

# === Scalability Constraints ===
scalability:
  max_actions_per_organization: "未定義（無制限）"
  concurrent_execution_limit: "Runnerのリソースに依存"
  telemetry_storage_retention: "未定義（将来的なポリシー必要）"
