version: "2.0"
updated_at: "2026-02-04T02:20:00Z"
updated_by: "audit-run-001"

# === Technical Constraints ===
technical:
  execution_environment:
    - "Self-hosted GitHub Runner必須"
    - "Claude Code CLI (`/usr/local/bin/claude`) がインストールされている必要がある"
    - "Linux系OS（Ubuntu推奨）"

  workflow_syntax:
    - "YAML heredoc (`<< EOF`) 禁止（AGENTS.md:159-189）"
    - "プレースホルダーは `{VARIABLE_NAME}` 形式を使用"
    - "テンプレートファイルは `actions/{name}/templates/` に配置"

  action_structure:
    - "各Actionは3つの構成要素が必須: action.yml, examples/, instructions/"
    - "テンプレートファイルを必ず使用（action.ymlにハードコード禁止）"
    - "composite run type + bash shell必須"

# === Security Constraints ===
security:
  path_validation:
    - "外部入力のパスはバリデーション必須"
    - "コマンドインジェクション対策（変数は二重引用符で囲む）"

  secret_handling:
    - "GitHub Tokenは `${{ github.token }}` をデフォルト使用"
    - "シークレットはログに出力しない"

  telemetry:
    - "匿名テレメトリー収集あり（オプトアウト可能）"
    - "リポジトリ名はSHA-256ハッシュで保存"
    - "DISABLE_TELEMETRY環境変数で無効化可能"

# === Operational Constraints ===
operational:
  testing:
    - "全ActionはDry Runモードで検証可能"
    - "構造検証（pytest）が必須"
    - "機能テストは実行時環境（GitHub Actions Runtime）を必要とするため現状未実装"

  deployment:
    - "Human-in-the-Loop原則：AIは提案・準備のみで最終決定権は人間が持つ"
    - "完全無人運用は目標としない（AIハルシネーションリスク考慮）"

  documentation:
    - "各Actionに利用例（examples/）と導入手順（instructions/）が必須"
    - "AGENTS.md, PURPOSE.md, SYSTEM_CONSTITUTION.mdが絶対ドキュメント"

# === Quality Constraints ===
quality:
  code_coverage:
    minimum: 70
    measurement: "pytest --cov=. --cov-fail-under=70"

  acceptance_rate:
    minimum: 70
    measurement: "python scripts/calculate_acceptance_rate.py --output report"

  action_validation:
    - "YAML構文チェック必須"
    - "構造チェック必須（pytest）"
    - "テンプレートファイル存在確認必須"

# === Resource Constraints ===
resources:
  execution_time_limit:
    description: "GitHub Actionsのデフォルト時間制限"
    limit: "6時間（標準）"

  claude_api_access:
    description: "Self-hosted RunnerからのClaude APIアクセス"
    requirement: "有効なAPIキーまたは認証設定"

# === Scope Constraints ===
scope:
  included:
    - "AIネイティブなGitHub Actions開発"
    - "構造検証とテスト"
    - "ドキュメント整備"
    - "テレメトリー収集"

  excluded:
    - "単なるシェルスクリプトラッパー"
    - "特定プロダクトに強く結合したロジック"
    - "完全無人運用の自動化"
    - "Runtime環境での完全な機能テスト（現状）"
