# PR-004: テストカバレッジ算出範囲の明記

**Status:** Ready for Implementation
**Priority:** Low
**Estimated Effort:** 30 minutes
**Gap Addressed:** GAP-007

## 概要

README.mdとTESTING.mdで「テストカバレッジ >= 70%」と記載しているが、
算出範囲（actions/とscripts/のみ）が明記されていない。
ユーザーがカバレッジ値の意味を正しく理解できるよう、ドキュメントを改善する。

## 現状

- **Coverage**: 89.33% (actions/ + scripts/のみ)
- **Documentation**: 算出範囲が明記されていない
- **Impact**: カバレッジ値の透明性が低下、ユーザーの誤解リスク

## 提案する変更

### 1. README.mdの更新

**箇所**: README.md:128-138

**Before:**
```markdown
### 📊 テストカバレッジ

このプロジェクトでは、テストカバレッジ >= 70% を目標としています。

#### カバレッジレポートの確認方法

```bash
# ローカルでカバレッジを計測
pytest --cov=actions --cov=scripts --cov-report=html
```
```

**After:**
```markdown
### 📊 テストカバレッジ

このプロジェクトでは、テストカバレッジ >= 70% を目標としています。

**算出範囲**: `actions/` ディレクトリ（AI Actionsの実装）と `scripts/` ディレクトリ
（メトリクス収集・分析ツール）のみを対象としています。全体のカバレッジは
これら2つのディレクトリの合計値です。

現在のカバレッジ: **89.33%** ✅ (目標達成)

#### カバレッジレポートの確認方法

```bash
# ローカルでカバレッジを計測（actions/ + scripts/）
pytest --cov=actions --cov=scripts --cov-report=html

# HTMLレポートを開く
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```
```

### 2. TESTING.mdの更新

**箇所**: TESTING.mdの冒頭（既存の説明の後ろに追加）

**追加内容:**
```markdown
## テストカバレッジ算出範囲

### 対象ディレクトリ

カバレッジ測定は以下のディレクトリのみを対象としています：

- `actions/`: AI Actionsの実装コード（Pythonモジュール）
- `scripts/`: メトリクス収集・分析ツール

**対象外のディレクトリ**:

- `tests/`: テストコード自体
- `examples/`: ワークフロー例（YAML）
- `instructions/`: ドキュメント（Markdown）
- `docs/`: ドキュメント
- `.github/`: GitHub Actionsワークフロー定義

### 算出方法

```bash
pytest --cov=actions --cov=scripts --cov-report=term-missing
```

上記コマンドで算出されるカバレッジは、actions/とscripts/の**合計値**です。

### 現在のカバレッジ

- **全体**: 89.33%
- **目標**: >= 70%
- **状態**: ✅ 達成

#### 内訳（参考）

| ファイル | カバレッジ | 備考 |
|---------|----------|------|
| actions/lib/__init__.py | 100.00% | - |
| actions/lib/acceptance_tracker.py | 88.89% | - |
| scripts/aggregate_metrics.py | 99.20% | - |
| scripts/calculate_acceptance_rate.py | 90.26% | - |
| scripts/collect_metrics.py | 94.92% | - |
| scripts/generate_adoption_report.py | 99.17% | - |
| scripts/generate_metrics_report.py | 99.30% | - |
| scripts/generate_telemetry_report.py | 78.29% | テレメトリー機能（未使用） |
| scripts/scan_adoption.py | 94.23% | - |
```

## 期待される効果

**Before:**
- ユーザーがカバレッジ89.33%の算出範囲を理解できない
- 「全体のカバレッジなのか？」という疑問が生じる
- 透明性が低下

**After:**
- 算出範囲が明確に文書化されている
- ユーザーがカバレッジ値を正しく解釈できる
- ドキュメントの透明性が向上

## 成功基準

1. [ ] README.mdに算出範囲の記載が追加されている
2. [ ] TESTING.mdに詳細な算出方法と内訳が記載されている
3. [ ] 現在のカバレッジ89.33%が明記されている
4. [ ] ドキュメントが一貫性を保っている

## ロールバック手順

ドキュメント更新のみのため、ロールバックは不要。
万が一の場合：

```bash
git revert <commit-hash>
```

## 副作用とリスク

**副作用**: なし（ドキュメント改善のみ）

**リスク**: なし

## 依存関係

- なし（単独で実施可能）

## 次のアクション

1. このPR案を承認するか、修正フィードバックを提供
2. README.mdとTESTING.mdを更新
3. ドキュメントの整合性を確認
4. PRを作成し、レビューを依頼
5. マージ

## 参考資料

- Gap Analysis: `.audit/analysis/gap.yml` (GAP-007)
- Coverage Report: `coverage.json`
- README.md:128-138
