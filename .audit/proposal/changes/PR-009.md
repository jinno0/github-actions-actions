# PR-009: Test Coverage Decrease Investigation

## 概要 (Overview)

**Gap**: ISS-MET-001 (Test coverage decreased from 92.97% to 88.31%)
**Severity**: Low
**Priority**: 2
**Estimated Effort**: 15-30 minutes

テストカバレッジが前回サイクルから4.66%低下した原因を調査し、是正が必要か判断します。

## 現状 (Current State)

- **前回値**: 92.97% (2026-02-08T16:25:09Z)
- **現在値**: 88.31% (2026-02-08T17:24:21Z)
- **低下**: -4.66%
- **目標値**: 80%
- **状態**: achieved_but_decreased (目標は達成しているが、低下トレンド)

## 調査手順 (Investigation Steps)

### Step 1: カバレッジレポートの詳細確認

```bash
cd /home/jinno/github-actions-actions
pytest --cov=actions --cov=scripts --cov-report=term-missing --tb=no -q
```

**期待出力**: 各モジュールのMissing列を確認し、どの行がカバレッジを失ったかを特定

### Step 2: 前回レポートとの比較

前回のレポートファイルを確認（あれば）:
```bash
cat .audit/execution/runs/2026-02-08T16:25:09Z/before/metrics.json
```

### Step 3: 原因の分類

低下の原因を以下のいずれかに分類:

1. **テストの変更**: テストケースが削除または変更された
2. **コードの変更**: 新しいコードパスが追加され、テストが追いついていない
3. **テスト環境の変化**: pytest設定やカバレッジ測定範囲の変更
4. **一時的な変動**: テストの不安定性によるもの

### Step 4: 是正の判断

| 原因 | 是正が必要か | アクション |
|------|--------------|-----------|
| テストの削除（バグ） | Yes | 削除されたテストを復元 |
| コード追加でテスト未実装 | Yes | 新しいコードパスのテストを追加 |
| 測定範囲の変更 | No | ドキュメントを更新 |
| 一時的な変動 | No | 次回サイクルで再確認 |

## 提案するアクション (Proposed Actions)

### Case A: 是正が必要な場合

1. **失われたカバレッジの復元**
   - テストケースの追加
   - テストの修正

2. **回復目標の設定**
   - 短期: 90% 以上
   - 長期: 93% 以上 (前回値の回復)

3. **回復タスクのPR作成**
   - PR-010: Test Coverage Recovery

### Case B: 是正が不要な場合

1. **ドキュメントの更新**
   - `.audit/analysis/as_is.yml` に低下の理由を記録
   - `ISS-MET-001` を close

2. **監視の継続**
   - 次回サイクルでカバレッジの推移を確認

## 期待される成果 (Expected Outcomes)

1. 低下原因の特定
2. 是正が必要かどうかの判断
3. 必要な場合は回復アクションの実行
4. 不要な場合は監視計画の策定

## 検証基準 (Success Criteria)

1. 原因が特定されている（どのモジュール/行が低下したか）
2. 是正の有無が判断されている
3. 必要な場合はアクションが実行されている
4. `.audit/analysis/gap.yml` の ISS-MET-001 が更新されている

## リスク評価 (Risk Assessment)

| リスク | 影響 | 緩和策 |
|--------|------|--------|
| 低下原因が特定できない | Low | git log でコード変更履歴を確認 |
| 是正アクションが過剰になる | Low | 目標値80%は既に達成しているため、強い是正は不要 |

## ロールバック手順 (Rollback)

なし（調査タスクのみのため）

## メタデータ

- **Proposed by**: audit-run-2026-02-08T17:24:21Z
- **Based on**: feedback_to_auditor.yml (priority 2 recommendation)
- **Type**: Investigation task
- **Dependencies**: None
- **Estimated completion**: 2026-02-08T17:30:00Z (within 10 minutes)
