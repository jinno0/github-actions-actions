# PR-005: Test Coverage Enhancement for Core Actions

## Summary
主要な3つのAction（review-and-merge, spec-to-code, action-fixer）について、ユニットテストを追加し、テストカバレッジを0%から50%以上に引き上げる。

## Motivation
- 現状、テストカバレッジが測定不能（0%）
- 品質の可視化と改善のため、テストカバレッジの向上が必須
- 主要なActionから順にテストを追加し、段階的にカバレッジを向上させる

## Background
- README.mdではテストカバレッジ70%を目標としている
- feedback_to_auditor.ymlで「まずは主要なActionのテストを追加」と指摘されている
- 前回監査でpytest-covは導入済み（framework_ready）

## Proposed Changes

### Phase 1: review-and-mergeのテスト追加
```python
# tests/test_review_and_merge.py
def test_review_and_merge_action_structure():
    """Actionの基本構造をテスト"""
    assert action_file_exists("actions/review-and-merge/action.yml")
    assert has_required_inputs("review-and-merge", ["claude-model", "lgtm-threshold"])

def test_review_and_merge_custom_rules():
    """カスタムルール機能をテスト"""
    # カスタムルールの読み込みと検証
    pass

def test_review_and_merge_confidence_scoring():
    """コンフィデンススコアリングをテスト"""
    # スコア計算ロジックのテスト
    pass
```

### Phase 2: spec-to-codeのテスト追加
```python
# tests/test_spec_to_code.py
def test_spec_to_code_validation():
    """path validation機能をテスト"""
    assert validates_path("src/", expected=True)
    assert validates_path("../etc", expected=False)

def test_spec_to_code_generation():
    """コード生成機能のモックテスト"""
    # 実際の生成はMockを使用
    pass
```

### Phase 3: action-fixerのテスト追加
```python
# tests/test_action_fixer.py
def test_action_fixer_yaml_validation():
    """YAMLバリデーション機能をテスト"""
    invalid_yaml = "invalid: ["
    result = validate_yaml(invalid_yaml)
    assert result.has_errors == True

def test_action_fixer_auto_fix():
    """自動修正機能をテスト"""
    # エラー修正ロジックのテスト
    pass
```

### 期待カバレッジ
- review-and-merge: 約50行のテスト → カバレッジ+20%
- spec-to-code: 約30行のテスト → カバレッジ+15%
- action-fixer: 約30行のテスト → カバレッジ+15%
- **合計: カバレッジ約50%達成**

## Expected Impact
- テストカバレッジ: 0% → 50%
- 主要な機能の回帰テストが可能に
- 品質の可視化が可能に

## Success Criteria
- pytest --cov でカバレッジ50%以上
- 全テストがpassする
- CIでテストが実行される

## Estimated Effort
- review-and-mergeのテスト: 2時間
- spec-to-codeのテスト: 1.5時間
- action-fixerのテスト: 1.5時間
- **合計: 約5時間**

## Dependencies
- pytest-cov (already installed)
- pytest-mock (for mocking external dependencies)

## Risks
- 中リスク: テスト追加自体は既存コードに影響しない
- テストが不完全な場合、false sense of securityを与える可能性

## Rollback Plan
テストのみ追加のため、ロールバックはコミットのrevertで対応可能

## Related Gaps
- GAP-001: テストカバレッジ向上

## Priority
Priority: 2 (品質可視化のため最優先)
