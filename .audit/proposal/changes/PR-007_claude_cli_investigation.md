# PR-007: Claude CLI統合のない6 Actionsの調査とドキュメント化

**Status**: Proposed  
**Priority**: MEDIUM  
**Gap ID**: GAP-004  
**Estimated Effort**: 1時間  
**Generated by**: audit-run-2026-02-08T13:55:13Z

---

## 概要 (Overview)

README.mdでは「Claude Code CLIを活用し、コードの文脈を理解した高度な自動化を実現する」と主張しているが、実際には6/13 (46%) のActionsがClaude CLI統合なしで実装されている。これらのActionsがClaude CLIを必要としない理由を調査し、README.mdの記載との整合性を確認する。

## 現状 (Current State)

**Claude CLI統合あり (7/13)**:
- action-fixer
- review-and-merge
- spec-to-code
- auto-document
- release-notes-ai
- auto-rebase
- auto-refactor

**Claude CLI統合なし (6/13)**:
- pr-review-enqueuer (PRをスキャンしAIレビューキューに登録)
- bulk-rebase-prs (複数のPRを一括リベース)
- bulk-merge-prs (複数のPRを一括マージ)
- auto-merge (PRが条件を満たす場合に自動マージ)
- review-auto-merge (AIレビュー後、CIパス時に自動マージ)
- publish-pr (ドラフトPRをレビュー準備完了に変更)

## 提案する変更 (Proposed Changes)

### 変更1: Claude CLI統合のない6 Actionsの用途分析

各Actionの機能と、Claude CLIを必要としない理由を調査・文書化する。

**調査項目**:
1. 各Actionの主な機能
2. なぜClaude CLI統合がないのか（技術的理由、設計上の判断）
3. Claude Code CLIの文脈理解を必要としない理由
4. 他のGitHub APIやツールで実現している機能

**期待される分析結果**:

#### pr-review-enqueuer
- 機能: PRをスキャンし、AIレビューキューに自動登録
- Claude CLI不要の理由: PRのメタデータ（タイトル、ラベル、変更ファイル）をスキャンするのみで、コードの文脈理解が不要
- 実装: GitHub API (`octokit`) のみを使用

#### bulk-rebase-prs
- 機能: 複数のPRを一括リベース
- Claude CLI不要の理由: Gitコマンドの自動実行のみで、コードの内容を理解・変更する必要がない
- 実装: Git CLI + GitHub API

#### bulk-merge-prs
- 機能: 複数のPRを一括マージ
- Claude CLI不要の理由: マージ条件のチェックとマージ実行のみで、コード解析が不要
- 実装: GitHub APIのみ

#### auto-merge
- 機能: PRが条件を満たす場合に自動マージ（squash/merge/rebase対応）
- Claude CLI不要の理由: 事前に定義されたマージ条件のチェックのみ
- 実装: GitHub API

#### review-auto-merge
- 機能: AIレビュー後、CIパス時に自動マージ（リトライ機能付き）
- Claude CLI不要の理由: AIレビューは別のActionで実行済み。このActionはCIパス後のマージ実行のみ担当
- 実装: GitHub API + 待機・リトライロジック

#### publish-pr
- 機能: ドラフトPRを自動的にレビュー準備完了に変更
- Claude CLI不要の理由: PRの状態変更のみで、コード解析が不要
- 実装: GitHub API

### 変更2: README.mdの記載の整合性確認と修正

**分析結果に基づいて、以下のいずれかの対応を実施**:

#### Option A: 現状の記載を維持し、補足説明を追加
README.md:3-4 の記載:
> Self-hosted runner上で動作する **Claude Code CLI** を活用し、文脈を理解した高度な自動化（レビュー、修正、ドキュメント生成など）を実現します。

以下の補足を追加:
> ※ 一部のActions（PR一括操作、自動マージ等）は、GitHub API等を活用し、Claude CLIを使用しない実装も採用しています。

#### Option B: 記載を修正し、より正確な表現に変更
> Self-hosted runner上で動作する **Claude Code CLI** を活用し、コードの文脈を理解した高度な自動化を実現します。また、GitHub API等を活用した一括操作や自動マージ等のActionsも提供しています。

### 変更3: 各Actionのドキュメントに補足

Claude CLI統合のない6 Actionsについて、各Actionのセットアップガイド (`instructions/*.md`) に以下の補足を追加:

**例: instructions/bulk-merge-prs.md**
```markdown
## アーキテクチャ

このActionはClaude Code CLIを使用しません。代わりにGitHub APIを活用し、
複数のPRのマージ条件チェックとマージ実行を行います。
```

## 実装手順 (Implementation Steps)

1. **6 Actionsの実装調査** (20分)
   ```bash
   # 各Actionのワークフローファイルを確認
   cat actions/bulk-merge-prs/action.yml
   cat actions/auto-merge/action.yml
   # ... 他4つ
   ```

2. **用途と理由の分析** (20分)
   - 各Actionの機能を把握
   - Claude CLI不要の技術的理由を特定
   - 使用しているツール・APIを特定

3. **分析ドキュメントの作成** (10分)
   - `.audit/analysis/claude_cli_integration_analysis.md` を作成
   - 6 Actionsの分析結果を記述

4. **README.mdの更新** (5分)
   - Option A または Option B のいずれかを採用し、記載を修正

5. **各Actionのドキュメント更新** (5分)
   - Claude CLI統合のない6 Actionsのセットアップガイドに補足を追加

## 期待効果 (Expected Benefits)

1. **ドキュメントの正確性**: README.mdと実態の整合性が確保される
2. **ユーザーの理解向上**: Claude CLIを使用する/しないActionsの区別が明確になる
3. **設計意図の説明**: Claude CLI統合の有無という設計上の意思決定が文書化される

## 副作用とリスク (Side Effects and Risks)

**リスク**:
- なし（ドキュメント修正のみのため）

**注意点**:
- README.mdの記載変更は、リポジトリの価値命题に影響を与える可能性があるため、慎重な表現が求められる

## ロールバック手順 (Rollback Procedure)

```bash
# 変更を取り消す
git checkout main -- README.md
git checkout main -- instructions/*.md
```

## 検証方法 (Verification)

**合格基準**:
1. 6 Actionsの分析ドキュメントが作成されている
2. README.mdの記載と実態が整合している
3. Claude CLI統合のないActionsのドキュメントに補足がある

**検証コマンド**:
```bash
# 分析ドキュメントの存在確認
ls -l .audit/analysis/claude_cli_integration_analysis.md

# README.mdの記載確認
grep -A 5 "Claude Code CLI" README.md

# 各Actionのドキュメント確認
for action in bulk-rebase-prs bulk-merge-prs auto-merge review-auto-merge publish-pr pr-review-enqueuer; do
    echo "=== $action ==="
    grep -i "claude" instructions/$action.md || echo "No Claude CLI mention"
done
```

## 依存関係 (Dependencies)

- なし（独立して実施可能）

## 参考資料 (References)

- README.md:3-4 - Claude Code CLIに関する記述
- `.audit/analysis/gap.yml` - GAP-004の詳細
- `actions/*/action.yml` - 各Actionの実装

## 関連課題 (Related Issues)

- Resolves: GAP-004
- Related: CF-002 (Claude CLI統合)

---

**決定**:
- [x] 提案生成完了
- [ ] 調査とドキュメント更新の実施 (15_executorへ委譲)
- [ ] 検証と完了確認

**次のアクション**:
15_executorがこのPR提案を実施する。分析完了後、GAP-004を "resolved" に更新すること。
