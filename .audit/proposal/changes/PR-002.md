# PR-002: Document Claude CLI Version Requirements

**Generated**: 2026-02-08
**Resolves**: ISS-002 (Claude Code CLI version not specified)
**Priority**: HIGH
**Estimated Impact**: HIGH (improves reproducibility and troubleshooting)
**Risk**: LOW (documentation only)

## Problem Statement
All 13 actions depend on Claude Code CLI but compatible versions are not specified. This creates compatibility risk and troubleshooting difficulty.

According to `.audit/analysis/gap.yml` ISS-002:
- **Impact**: HIGH - Actions may break with CLI updates, no reproducibility guarantee
- **Intent Source**: ASM-004 (AI Engine: Claude Code CLI)
- **Current State**: No version requirements documented

## Proposed Changes

### 1. Update README.md
Add section after "Requirements":
```markdown
### Claude Code CLI Version

**Minimum Required Version**: 1.0.0 (estimated - requires testing)

**Recommended**: Use latest stable version from npm

**Installation**:
\`\`\`bash
npm install -g @anthropic-ai/claude-code
# Or
pip install claude-code-cli
\`\`\`

**Version Compatibility**:
- Tested with: Claude Code CLI 1.0.0+
- For specific version pinning in workflows, see examples below

**Note**: Version requirements are based on current implementation. If you encounter compatibility issues, please report them with your CLI version.
```

### 2. Update Example Workflows
Pin CLI version in 3 representative examples:

#### `examples/review-and-merge.yml`
Add comment or step:
```yaml
- name: Setup Claude Code CLI
  run: |
    # Pin to specific version for reproducibility
    npm install -g @anthropic-ai/claude-code@1.0.0
```

#### `examples/spec-to-code.yml`
Add version documentation in comments

#### `examples/action-fixer.yml`
Add version documentation in comments

### 3. Update `.github/workflows/test-with-dry-run.yml`
```yaml
- name: Install Claude Code CLI
  run: |
    # Use specific version for CI reproducibility
    npm install -g @anthropic-ai/claude-code@1.0.0
```

### 4. Create CLI Version Testing Checklist
Create `docs/cli-version-testing.md`:
```markdown
# Claude CLI Version Testing

## Testing Checklist for New CLI Versions

Before updating the minimum CLI version in documentation:
1. Run full test suite: `pytest --cov=.`
2. Execute dry-run workflow: `.github/workflows/test-with-dry-run.yml`
3. Test each action manually with representative example
4. Verify no breaking changes in CLI API

## Version Upgrade Process

1. Test new CLI version in development branch
2. Update version in README.md
3. Update pinned versions in CI workflows
4. Update this document with test results
5. Merge and monitor for issues
```

## Files to Create
- `docs/cli-version-testing.md` (new)

## Files to Modify
- `README.md` (add CLI version section)
- `examples/review-and-merge.yml` (add version comment)
- `examples/spec-to-code.yml` (add version comment)
- `examples/action-fixer.yml` (add version comment)
- `.github/workflows/test-with-dry-run.yml` (pin version)

## Success Criteria
1. ✅ README documents minimum CLI version
2. ✅ Example workflows show version pinning
3. ✅ CI workflow pins CLI version
4. ✅ Testing checklist created
5. ✅ All existing tests still pass

## Verification Plan
```bash
# Verify documentation is clear
grep -A 10 "Claude Code CLI Version" README.md

# Verify examples updated
grep "claude-code@" examples/*.yml

# Run tests to ensure no regressions
pytest --cov=.
```

## Rollback Plan
If documentation causes confusion:
```bash
git revert <commit-hash>
# Version info can be clarified in follow-up
```

## Estimated Time
- Research actual CLI version: 15 minutes
- Documentation updates: 30 minutes
- Example updates: 15 minutes
- Testing: 15 minutes
- Total: 1 hour 15 minutes

## Dependencies
- Need to determine actual minimum CLI version (currently estimated as 1.0.0)
- May require testing with different CLI versions

## Open Questions
1. What is the actual minimum Claude CLI version that works?
   - **Action**: Check package.json or test with oldest available version
2. Should we enforce version via action.yml inputs?
   - **Recommendation**: No, keep flexible for now (document only)
3. How frequently does Claude CLI release breaking changes?
   - **Action**: Monitor Claude CLI changelog

## Notes
- This is primarily a documentation change
- Does not enforce version checking in code
- Encourages users to pin versions in their workflows
- CI will use pinned version for reproducibility
- May need updates after actual CLI version testing
