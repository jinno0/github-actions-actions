# Gap Analysis
# Comparison between intent and current state
# Generated by Repo Genesis Auditor v2.0
# Run: audit-run-002 (Post-Execution Analysis)

generated_at: "2026-02-02T11:10:00Z"
previous_run: "2026-02-02T09:00:00Z"
execution_feedback: "2026-02-02T09:18:00Z"

# === Summary ===
summary:
  total_gaps: 3
  critical: 0
  high: 1
  medium: 1
  low: 1
  closed_gaps: 2  # GAP-001, GAP-002 closed by execution

# === Closed Gaps (Previous Cycle) ===

closed_gaps:
  - id: "GAP-001"
    severity: "critical"
    category: "test_coverage"
    closed_by: "PR-001"
    closed_at: "2026-02-02T09:22:00Z"
    resolution: |
      PR-001で残り10アクションのテストを実装。
      13/13アクションがテストカバー完了。
      テスト数: 60 → 168 (180%増加)
      カバレッジ: 95.3% → 97.51%
    verification: "pytest 168 passed, 97.51% coverage"

  - id: "GAP-002"
    severity: "high"
    category: "adoption_tracking"
    closed_by: "PR-003"
    closed_at: "2026-02-02T09:18:00Z"
    resolution: |
      PR-003でADOPTION.mdを作成。
      チーム登録テンプレート、統計追跡、タイムラインを実装。
      導入追跡メカニズムが整備完了。
    verification: "ADOPTION.md exists with tracking structure"

# === Remaining Gaps ===

gaps:
  - id: "GAP-006"
    severity: "high"
    category: "verification"
    related_qa: "QA-001"
    source: "ISS-NEW-002 (feedback_to_auditor.yml)"

    intent:
      statement: "全アクションがDry Runモードで検証可能"
      source: "CF-004, README.md:74"

    current_state:
      statement: "構造検証は完了、E2E実行検証は未実装"
      metric: "168 tests (structural only)"
      evidence: "tests validate action.yml, templates, syntax - no actual execution"

    gap_description: |
      現在のテストスイートは構造的検証（action.ymlの存在、テンプレートの可読性、YAML構文）に特化している。
      しかし、実際のアクション実行を検証するE2Eテストは存在しない。
      これはself-hosted runnerとClaude CLIが必須であるため。

      構造検証のみでは以下を保証できない:
      - 実際のワークフロー実行時の挙動
      - Claude CLIとの連携動作
      - エラーハンドリングの実効性
      - マージ時の副作用

    impact: |
      - 構造的エラーは検知できるが、実行時エラーは検知できない
      - 本番投入時に初めて発見される問題のリスク
      - 回帰テストの不備

    root_cause: |
      E2Eテストには以下が必要だが、現在環境が整備されていない:
      - Self-hosted GitHub Actions Runner
      - Claude Code CLIのインストール
      - テスト用リポジトリとワークフロー
      - 実行時間とコスト

    recommended_action: |
      優先度: 中
      実行条件: Self-hosted runnerが利用可能になった時点で実装
      方法: GitHub Actionsのmatrix strategyを使用したE2Eテスト

  - id: "GAP-007"
    severity: "medium"
    category: "adoption"
    related_assumption: "ASM-004"
    source: "ISS-NEW-003 (feedback_to_auditor.yml)"

    intent:
      statement: "組織内の複数のリポジトリ（1〜1000リポジトリ規模）で採用される"
      source: "ASM-004 (updated)"

    current_state:
      statement: "導入実績: 0チーム, 0リポジトリ"
      metric: "0 teams, 0 repositories"
      evidence: "ADOPTION.md:5-9"

    gap_description: |
      ADOPTION.mdで追跡メカニズムは実装されたが、実際の導入実績がまだない。
      これにより以下が不明のままである:
      - 想定した組織規模（1〜1000リポジトリ）の妥当性
      - 実際の導入障壁と課題
      - ユーザーフィードバックと改善点

      ただし、これは「問題」ではなく「導入前の自然な状態」。

    impact: |
      - 組織規模の仮定（ASM-004）が検証されていない
      - 成功条件の評価が実際の導入開始までできない

    root_cause: |
      導入プロセスが開始されていない。
      技術的準備完了（テスト、ドキュメント）から、組織的導入への移行待ち。

    recommended_action: |
      優先度: 高（組織次）
      アクション: パイロット導入の開始
      方法:
      1. 興味のあるチームを1〜2チーム特定
      2. 非クリティカルなリポジトリでパイロット実施
      3. ADOPTION.mdへ登録とフィードバック記録

  - id: "GAP-008"
    severity: "low"
    category: "documentation"
    related_qa: "QA-003"

    intent:
      statement: "全アクションにREADME.mdが存在"
      source: "QA-003 (documentation coverage)"

    current_state:
      statement: "4/13アクションにのみREADME.mdが存在"
      metric: "31% (4/13 actions)"
      evidence: "actions/*/README.md count"

    gap_description: |
      actions/review-and-merge/, actions/spec-to-code/, actions/auto-document/, actions/auto-refactor/
      の4アクションにはREADME.mdが存在し、詳細な説明が提供されている。

      しかし、残り9アクションにはREADME.mdがない。
      これらはinstructions/*.mdとexamples/*.ymlで代替されているが、
      アクションディレクトリ直下にREADMEがないと発見性が低下する。

    impact: |
      - アクションディレクトリを直接参照した際の理解コスト
      - 一貫性の欠如（あるアクションとないアクション）
      - 新規ユーザーの迷い

    root_cause: |
      ドキュメント戦略が分散している:
      - README.md (詳細説明、4アクションのみ)
      - instructions/*.md (導入手順、全アクション)
      - examples/*.yml (使用例、全アクション)

    recommended_action: |
      優先度: 低
      方法: instructions/*.mdの内容をベースに各アクションのREADME.mdを生成
      工数: 9アクション × 30分 = 4.5時間（自動化可能）

# === Cross-Cutting Issues ===
cross_cutting_issues:
  - name: "Verification Completeness"
    description: |
      構造検証（実装済み）と実行検証（未実装）のギャップ。
      技術的制約（self-hosted runner必須）により、現状は構造検証で妥協している。
      これは合理的な判断だが、将来的なE2Eテスト導入のロードマップが必要。

    affected_gaps:
      - "GAP-006 (high)"

  - name: "Organizational Adoption"
    description: |
      技術的準備は完了したが、組織的導入が開始されていない。
      パイロット導入とフィードバック収集が次の重要マイルストーン。
      ASM-004の検証には実際の導入データが必要。

    affected_gaps:
      - "GAP-007 (medium)"

# === Priority Matrix ===
priority_matrix:
  urgent_critical: []  # No critical gaps remaining!

  high_importance:
    - "GAP-006: E2E検証の設計（実装はrunner準備後）"
    - "GAP-007: パイロット導入の開始と追跡"

  medium_importance:
    - "GAP-008: 残り9アクションのREADME.md追加"

  backlog:
    - "パフォーマンスベンチマークの追加"
    - "エラーシナリオテストの拡充"
    - "セキュリティスキャンの自動化"

# === Progress Tracking ===
progress_tracking:
  closed_this_cycle: 2
  remaining: 3
  total_closed: 2
  total_identified: 5

  closure_rate: "40% (2/5)"
  trend: "improving"

  next_cycle_focus:
    - "E2Eテスト設計（実装タイミングの決定）"
    - "パイロット導入の調整"
    - "ドキュメントの一貫性改善"
