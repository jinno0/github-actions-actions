# Gap Analysis
version: "2.0"
updated_at: "2026-02-04T12:34:00Z"
updated_by: "audit-run-002"

# === Gap Summary ===
gap_summary:
  total_gaps: 5
  critical: 0
  important: 2
  nice_to_have: 3

# === Detailed Gaps ===
gaps:
  - id: "GAP-001"
    category: "quality_attributes"
    severity: "important"
    related_assumption: "ASM-002"
    related_qa: "QA-001"

    current_state:
      metric: "AIレビュー受入率"
      value: "未計測（データ不足）"
      evidence: "実運用でのレビューデータがまだ収集されていない"

    desired_state:
      metric: "AIレビュー受入率"
      target: ">= 70%"
      based_on: "ASM-002: 業界標準のAIレビュー受入率"

    gap_description: |
      AIレビュー受入率の計測インフラ（scripts/calculate_acceptance_rate.py）は整備されているが、
      実際の運用データが不足しており、目標（70%）に対する達成状況を判断できない。

    impact:
      - "QA-001の目標達成状況が不明"
      - "AIレビューの品質トレンドを追跡できない"
      - "改善の余地がある場合、早期検知ができない"

    recommended_actions:
      - id: "ACT-001-1"
        priority: "high"
        description: "review-and-merge Actionの組織内導入を進める"
        estimated_effort: "1-2週間"
        expected_outcome: "実際のレビューデータの収集開始"

      - id: "ACT-001-2"
        priority: "medium"
        description: "週次で受入率レポートを生成し、トレンドを監視"
        estimated_effort: "継続的（週1回、5分）"
        expected_outcome: "品質の変化を早期に検知"

  - id: "GAP-002"
    category: "quality_attributes"
    severity: "important"
    related_qa: "QA-002"

    current_state:
      metric: "生成コード成功率"
      value: "未測定"
      evidence: "spec-to-codeのテストカバレッジは99%だが、実際の使用成功率は未測定"

    desired_state:
      metric: "生成コード成功率"
      target: ">= 90%"
      based_on: "intent.yml QA-002"

    gap_description: |
      spec-to-codeのテストカバレッジは99%と高いが、これは単体テストのカバレッジであり、
      実際の仕様書からのコード生成成功率（ユーザー視点の成功率）は未測定。

    impact:
      - "QA-002の目標達成状況が不明"
      - "実際のユースケースでの失敗パターンが把握できない"

    recommended_actions:
      - id: "ACT-002-1"
        priority: "medium"
        description: "spec-to-codeの使用実績から成功/失敗ケースを収集"
        estimated_effort: "1ヶ月（データ収集期間）"
        expected_outcome: "実際の成功率と失敗パターンの把握"

      - id: "ACT-002-2"
        priority: "low"
        description: "成功した仕様書のパターンをテンプレート化"
        estimated_effort: "2-3週間"
        expected_outcome: "ユーザーによる成功確率の向上"

  - id: "GAP-003"
    category: "development_maturity"
    severity: "nice_to_have"
    related_evidence: "C-103"

    current_state:
      phase: "Phase 3: Stabilization & Adoption"
      progress: "75%"
      pending_items:
        - "組織内プロジェクトへの導入とフィードバック収集"

    desired_state:
      phase: "Phase 3: Stabilization & Adoption"
      progress: "100%"
      all_items_completed: true

    gap_description: |
      PURPOSE.mdによると、Phase 3の5つの項目中4つが完了済み。
      残りの「組織内プロジェクトへの導入とフィードバック収集」が未完了。

    impact:
      - "実際の運用での課題が把握できない"
      - "改善サイクルが回せていない"

    recommended_actions:
      - id: "ACT-003-1"
        priority: "high"
        description: "パイロットプロジェクトを選定し、Actionsを導入"
        estimated_effort: "2-4週間"
        expected_outcome: "実際の運用フィードバックの収集開始"

      - id: "ACT-003-2"
        priority: "medium"
        description: "フィードバックを収集する仕組み（GitHub Issuesやアンケート）を整備"
        estimated_effort: "1週間"
        expected_outcome: "体系的なフィードバック収集"

  - id: "GAP-004"
    category: "security"
    severity: "nice_to_have"
    related_constraints: "constraints.yml security.path_validation"

    current_state:
      item: "パス検証の実装状況"
      status: "verification_needed"
      evidence: "constraints.ymlで必須とされているが、実装状況は未確認"

    desired_state:
      item: "パス検証の実装"
      status: "implemented_and_verified"
      requirement: "全てのActionsでファイルパスの厳格なバリデーション"

    gap_description: |
      constraints.ymlで「パストラバーサル攻撃の防止」のためのパス検証が必須とされているが、
      各Actionでの実装状況が確認されていない。

    impact:
      - "セキュリティリスクの可能性"
      - "コンプライアンス要件を満たしているか不明"

    recommended_actions:
      - id: "ACT-004-1"
        priority: "medium"
        description: "各Actionのスクリプトでパス検証が実装されているか監査"
        estimated_effort: "1週間"
        expected_outcome: "セキュリティ実装状況の確認"

      - id: "ACT-004-2"
        priority: "high"
        description: "パス検証のテストケースを追加"
        estimated_effort: "3-5日"
        expected_outcome: "セキュリティテストカバレッジの向上"

  - id: "GAP-005"
    category: "observability"
    severity: "nice_to_have"
    related_qa: "QA-001"

    current_state:
      item: "AIレビュー品質メトリクスの可視化"
      status: "収集機能はあるが、ダッシュボードがない"
      evidence: "README.md:121-139に記載あり、計測スクリプト存在"

    desired_state:
      item: "AIレビュー品質メトリクスのダッシュボード"
      status: "implemented"
      requirement: "受入率、レビューアウトカム、提案数などを可視化"

    gap_description: |
      AIレビュー品質メトリクスの収集機能はあるが、GitHub ActionsのSummaryや
      別途ダッシュボード等で可視化されていないと推測。

    impact:
      - "メトリクス確認のためにコマンドを実行する必要がある"
      - "継続的な監視が不便"

    recommended_actions:
      - id: "ACT-005-1"
        priority: "low"
        description: "GitHub ActionsのSummaryに品質メトリクスを表示"
        estimated_effort: "2-3日"
        expected_outcome: "PRごとのレビュー品質がすぐに確認可能"

      - id: "ACT-005-2"
        priority: "low"
        description: "定期的にメトリクスレポートをIssueやWikiに投稿"
        estimated_effort: "1週間"
        expected_outcome: "履歴の追跡が容易"

# === No Gaps (Exceeds Expectations) ===
no_gaps:
  - id: "NOGAP-001"
    qa: "QA-006, QA-COMMON-001"
    description: "テストカバレッジ"
    current: 93.96
    target: 70
    unit: "%"
    status: "exceeds_by_23.96%"

  - id: "NOGAP-002"
    qa: "QA-COMMON-002"
    description: "ドキュメント網羅性"
    current: 100
    target: 100
    unit: "%"
    status: "meets"

  - id: "NOGAP-003"
    description: "Core Functions Implementation"
    functions:
      - "CF-001: review-and-merge"
      - "CF-002: spec-to-code"
      - "CF-003: action-fixer"
      - "CF-004: auto-refactor"
      - "CF-005: auto-document"
      - "CF-006: Dry Run検証"
    status: "全て実装済み"

# === Gap Priority Ranking ===
gap_priority_ranking:
  - rank: 1
    gap_id: "GAP-001"
    reason: "AIレビュー受入率は中核品質指標であり、早期のデータ収集が必要"

  - rank: 2
    gap_id: "GAP-003"
    reason: "Phase 3完了には組織内導入が必須"

  - rank: 3
    gap_id: "GAP-004"
    reason: "セキュリティは重要だが、現段階では実装状況の確認で十分"

  - rank: 4
    gap_id: "GAP-002"
    reason: "テストカバレッジが高いため、緊急性は低い"

  - rank: 5
    gap_id: "GAP-005"
    reason: "可視化は品質には直接影響しない"
