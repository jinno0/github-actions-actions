version: "2.0"
run_id: "2026-02-07T07:48:00Z"
generated_at: "2026-02-07T07:48:00Z"
generated_by: "audit-run-002"
previous_audit_run_id: "2026-02-07T05:40:11"
execution_feedback_processed: true

summary:
  total_gaps: 6
  critical_gaps: 1
  high_gaps: 3
  medium_gaps: 1
  low_gaps: 1
  gaps_closed_since_last_audit: 1
  new_gaps_identified: 1
  gaps_investigation_needed: 1

gaps:
  - id: "GAP-001"
    title: "AIレビュー受入率のベースライン未策定"
    severity: "high"
    category: "quality_metrics"
    status: "closed"
    current_state: "ベースラインフレームワークは完了しているが、実データが0件"
    desired_state: "受入率>=70%の目標に対し、現状のベースライン値が確定している"
    gap_description: "目標値(70%)は設定されているが、現在の実績値が不明。review_metrics.jsonが存在しないため、品質改善サイクルを回すためのスタートラインが引かれていない。"
    impact: "AIレビューの品質改善効果を測定できない"
    based_on_assumption: "ASM-004（受入率目標>=70%）"
    resolution_date: "2026-02-07"
    resolution_summary: "Phase 1実行によりベースラインフレームワーク完了。baseline report, methodology doc, examplesが作成された。"
    remaining_actions: "ISS-NEW-001の解決後、20件以上のレビューデータ収集時に実際のベースライン値を算出する必要がある。"
    blocker: "ISS-NEW-001"

  - id: "GAP-002"
    title: "パイロットプロジェクトからのフィードバック収集が不十分"
    severity: "high"
    category: "adoption"
    status: "open"
    current_state: "PURPOSE.md:25でPhase 3の「組織内プロジェクトへの導入とフィードバック収集」が未完了"
    desired_state: "2件のパイロットプロジェクトから具体的なフィードバック、改善要望、課題が収集され公開されている"
    gap_description: "導入実績(2件)は主張しているが、実際はプレースホルダー。フィードバックの内容や改善点がREADMEやADOPTION.mdで公開されていない。"
    impact: "他の組織プロジェクトでの導入検討時の参考情報が不足。Phase 3完了の障害になっている。"
    based_on_assumption: "ASM-006（2 pilot projects - しかしrejected）"
    new_findings:
      - issue: "ISS-NEW-002: ADOPTION.mdのパイロットプロジェクトがプレースホルダー（example/repo-1, example/repo-2）のまま"
        severity: "high"
        evidence: "Executor feedback, C-010, C-106"
        recommendation: "実際のリポジトリ名と連絡先情報に更新する必要がある。または、採用クレームを撤回する。"
    priority_for_next_cycle: "highest"
    recommended_phase: "Phase 2"
    blocker: "ISS-NEW-002 (awaiting human input)"

  - id: "GAP-003"
    title: "テレメトリー収集状況の可視化が不足"
    severity: "medium"
    category: "observability"
    status: "open"
    current_state: "README.md:120-137にテレメトリー機能の説明はあるが、収集データの集計結果が公開されていない"
    desired_state: "どのActionがどの程度使われているか、オプトアウト率などの傾向が把握できている"
    gap_description: "テレメトリー機能は未実装。READMEには説明があるが、実際のデータ収集と分析が行われていない。"
    impact: "Actionsの人気度や使用傾向を把握できず、開発優先順位の判断材料が不足"
    related_claims: ["C-007", "C-202"]
    updated findings:
      - "ASM-007: telemetry.data_collection のステータスが 'not_working' に変更"
      reason: "metrics/telemetry/ ディレクトリは空であり、実際のデータ収集は行われていない"

  - id: "GAP-004"
    title: "AIレビューの誤検知(false positive)の追跡が不十分"
    severity: "medium"
    category: "quality_metrics"
    status: "pending"
    current_state: "README.md:152-155にレビューアウトカムの種類は記載されているが、詳細な分布データがない"
    desired_state: "誤検知率の傾向と主な原因が分析でき、改善につなげられている"
    gap_description: "受入率だけでは不十分。AIレビューがなぜ拒否/修正されるのか、誤検知の傾向分析が必要。"
    impact: "AIレビュー品質の向上に必要な詳細データが不足"
    dependency: "GAP-001の解決（データ収集完了）後に実施可能"
    blocker: "ISS-NEW-001"

  - id: "GAP-005"
    title: "カスタムレビュールールの利用実績が不明"
    severity: "low"
    category: "features"
    status: "pending"
    current_state: "README.md:66-76にカスタムルール機能の充実したドキュメントがあるが、利用事例が公開されていない"
    desired_state: "パイロットプロジェクトでのカスタムルール導入事例やベストプラクティスが共有されている"
    gap_description: "機能は充実しているが、実際の現場での活用方法や効果が不明"
    impact: "他のチームがカスタムルール導入を検討する際の参考情報が不足"
    blocker: "ISS-NEW-002 (パイロットプロジェクト不明のため)"

  - id: "GAP-006"  # NEW
    title: "テストカバレッジ測定値の不整合"
    severity: "critical"  # criticalに昇格
    category: "quality_metrics"
    status: "investigation_needed"
    current_state: "coverage.json (92.99%) と pytest report (11.11%) の値が大きく異なる"
    desired_state: "coverage.json と pytest report の値が一致し、信頼できるカバレッジ値が算出されている"
    gap_description: "同一のテスト実行であるにも関わらず、coverage.jsonとpytest reportで82%ポイントもの差がある。この不整合により、QA-001の評価の信頼性が損なわれている。"
    impact: "テストカバレッジが目標70%を超えているという前提自体が怪しくなっている。実際のカバレッジが11%しかない可能性もある。"
    based_on_assumption: "ASM-003（テストカバレッジ>=70%）"
    suspected_causes:
      - cause: "coverage.py の設定ファイル (.coveragerc) の誤り"
        probability: "medium"
      - cause: "pytest の --cov 引数の指定ミス"
        probability: "medium"
      - cause: "coverage.json が古いデータまたは別の環境での実行結果"
        probability: "high"
      - cause: "テスト対象ディレクトリの指定が不一致"
        probability: "medium"
    investigation_priority: "highest"
    recommended_actions:
      - action: ".coveragerc と pytest.ini の設定を確認"
        effort: "1-2 hours"
        command: "cat .coveragerc pytest.ini"
      - action: "coverage.json 生成時のコマンドを確認"
        effort: "1 hour"
        command: "git log --all --full-history -- coverage.json | head -20"
      - action: "テストをクリーンな状態で再実行"
        effort: "2-3 hours"
        command: "rm .coverage && coverage run -m pytest && coverage report && coverage json"
    blocker: "ISS-NEW-004"

new_issues:
  - id: "ISS-NEW-001"
    title: "レビューデータ収集プロセスが稼働していない"
    severity: "high"
    category: "infrastructure"
    description: "metrics/review_metrics.json が存在しない。これは review-and-merge Action がレビュー結果を保存する機能が有効化されていないか、パイロットプロジェクトで実際に使用されていないことを示唆している。"
    source: "Executor feedback (2026-02-07T06:17:33Z), audit-run-001"
    status: "open"
    evidence:
      - claim_id: "C-007"
        description: "ファイルシステム確認で review_metrics.json が存在しない"
      - claim_id: "C-105"
        description: "レビューデータ収集プロセスが稼働していない可能性が高い"
    recommended_actions:
      - action: "パイロットプロジェクトで review-and-merge Action が実際に稼働しているか確認"
        effort: "2-4 hours"
        blocker: "ISS-NEW-002 (パイロットプロジェクト不明)"
      - action: "metrics/review_metrics.json への出力プロセスを確認"
        effort: "1-2 hours"
      - action: "必要に応じてデータ収集ワークフローを整備"
        effort: "4-8 hours"
    related_gaps: ["GAP-001", "GAP-004"]

  - id: "ISS-NEW-002"
    title: "パイロットプロジェクトの特定と連絡先が不明"
    severity: "high"
    category: "adoption"
    description: "roadmap.md の Phase 2（User Feedback Collection）では「2つのパイロットプロジェクト」と言及しているが、具体的にどのリポジトリか、誰に連絡すべきかが明記されていない。ADOPTION.md もプレースホルダーのまま。"
    source: "Executor feedback (2026-02-07T06:17:33Z), ADOPTION.md:19-20"
    status: "awaiting_human_input"
    evidence:
      - claim_id: "C-010"
        description: "ADOPTION.md のパイロットプロジェクトが example/repo-1, example/repo-2 （プレースホルダー）"
      - claim_id: "C-106"
        description: "実際のパイロットプロジェクトが不明確"
      - claim_id: "C-205"
        description: "パイロットプロジェクトの連絡先情報が不明"
    recommended_actions:
      - action: "ADOPTION.md を更新し、実際のリポジトリ名と連絡先を記載"
        effort: "1-2 hours"
        requires: "human input (実際のプロジェクト情報)"
      - action: "各パイロットプロジェクトの担当者とインタビューのスケジュール調整"
        effort: "2-4 hours"
        requires: "human input"
      - action: "roadmap.md に具体的なプロジェクト名と担当者を追記"
        effort: "0.5 hours"
        requires: "human input"
    alternative_resolution:
      - action: "パイロットプロジェクトが実際には存在しない場合、採用クレームを撤回"
        effort: "1 hour"
        impact: "README.md、ADOPTION.md、ADOPTION_GUIDE.md の修正が必要"
    related_gaps: ["GAP-002", "GAP-005"]

  - id: "ISS-NEW-003"  # NEW
    title: "ドキュメント構造のSYSTEM_CONSTITUTION.mdとの不一致"
    severity: "low"
    category: "documentation"
    description: "SYSTEM_CONSTITUTION.md:81-92 では各Actionに examples/ と instructions/ ディレクトリを求めているが、実際はトップレベルに集約されている。"
    source: "audit-run-002"
    status: "documented"
    evidence:
      - "actions/*/ 配下に examples/ ディレクトリが存在しない"
      - "actions/*/ 配下に instructions/ ディレクトリが存在しない"
      - "トップレベルの examples/ に {action-name}-example.yml として提供"
      - "トップレベルの instructions/ に {action-name}.md として提供"
    impact: "低。機能的には問題ないが、ドキュメントと実装が不一致。"
    recommended_actions:
      - action: "SYSTEM_CONSTITUTION.md を更新し、実際の構造を反映"
        effort: "1-2 hours"
        priority: "low"
      - alternative: "actions/*/ 配下に examples/, instructions/ のシンボリックリンクを作成"
        effort: "2-3 hours"
        priority: "low"
    confidence: "high"

  - id: "ISS-NEW-004"  # NEW
    title: "coverage.py 設定の不整合によりテストカバレッジが正しく測定できない"
    severity: "critical"
    category: "infrastructure"
    description: "coverage.json (92.99%) と pytest report (11.11%) の値が大きく異なり、どちらが正しいか判断できない状態。"
    source: "audit-run-002"
    status: "investigation_needed"
    evidence:
      - claim: "coverage.json: percent_covered = 92.99"
      - claim: "pytest report: FAIL Required test coverage of 70% not reached. Total coverage: 11.11%"
      - claim: "同じテストスイート (457 tests) であるにも関わらず、結果が異なる"
    impact:
      - "QA-001 (テストカバレッジ>=70%) の評価が不可能"
      - "ASM-003 の仮定が正しいか検証できない"
      - "リポジトリの品質状況を正しく把握できない"
    investigation_plan:
      - step: "1. .coveragerc と pytest.ini の設定を確認"
        command: "cat .coveragerc pytest.ini"
      - step: "2. coverage.json の生成履歴を確認"
        command: "git log --all --full-history -- coverage.json | head -20"
      - step: "3. テスト対象ディレクトリの設定を確認"
        command: "grep -r 'omit' .coveragerc pytest.ini pyproject.toml"
      - step: "4. クリーンな状態でテストを再実行"
        command: "rm .coverage coverage.json && coverage run -m pytest && coverage report && coverage json"
    estimated_effort: "2-4 hours"
    related_gaps: ["GAP-006"]
    related_assumptions: ["ASM-003"]

strengths:
  - id: "STR-001"
    description: "13件のActionsが提供され、カテゴリ別に整理されている"
    evidence: "actions/ ディレクトリ構造"
    quality_level: "excellent"
    maintained: true

  - id: "STR-002"
    description: "ドキュメントカバー率100% - 全ActionにREADME、Example、Instructionが存在"
    evidence: "QA-003: ドキュメントカバー率100%"
    quality_level: "excellent"
    maintained: true

  - id: "STR-003"
    description: "カスタムレビュールールのドキュメントとチュートリアルが充実"
    evidence: "examples/custom-rules-tutorial.md, instructions/review-and-merge-custom-rules.md"
    quality_level: "excellent"
    maintained: true

  - id: "STR-004"
    description: "セキュリティとプライバシーへの配慮が行き届いている"
    evidence: "SYSTEM_CONSTITUTION.md:61-67, README.md:120-137"
    quality_level: "excellent"
    maintained: true

  - id: "STR-005"
    description: "開発プロセスが高度に自動化されている（Dry Run検証、YAML構文チェックなど）"
    evidence: "AGENTS.md, TESTING.md"
    quality_level: "excellent"
    maintained: true

  - id: "STR-006"
    description: "Phase 1実行により、品質メトリクス測定フレームワークが完了した"
    evidence: "metrics/acceptance-rate-baseline-2026-02-07.md, scripts/calculate_acceptance_rate.py"
    quality_level: "excellent"
    added_date: "2026-02-07"
    maintained: true

assumption_updates:
  - id: "ASM-003"
    field: "quality_attributes.test_coverage"
    previous_value: ">= 70%"
    new_value: ">= 70% (ただし測定値の不整合あり: reported 92.99% vs pytest 11.11%)"
    previous_status: "unverified"
    new_status: "needs_revision"
    reason: "coverage.json と pytest report の値が大きく異なり、実態が不明"
    confidence: "low"
    recommended_action: "ISS-NEW-004 の解決を優先"

  - id: "ASM-006"
    field: "user_adoption"
    previous_value: "2 pilot projects"
    new_value: "不明（プレースホルダーのみ）"
    previous_status: "unverified"
    new_status: "rejected"
    reason: "Executor feedback により、プレースホルダーであることが判明"
    confidence: "high"
    recommended_action: "ISS-NEW-002 の解決を優先（実際のプロジェクト特定または採用クレーム撤回）"

  - id: "ASM-007"
    field: "telemetry.data_collection"
    previous_value: "working"
    new_value: "not_working"
    previous_status: "working"
    new_status: "not_working"
    reason: "metrics/telemetry/ ディレクトリが空であり、実際のデータ収集は行われていない"
    confidence: "high"

lessons_learned:
  - lesson: "測定ツールは整備されているが、データ収集プロセスを別途確認が必要"
    related_issue: "ISS-NEW-001"
    context: "scripts/calculate_acceptance_rate.py は正常に動作するが、入力データ（metrics/review_metrics.json）が空"
    applied_to: "GAP-006の調査計画"

  - lesson: "パイロットプロジェクトの特定は早めに行うべき"
    related_issue: "ISS-NEW-002"
    context: "Phase 2の実行には具体的な連絡先情報が必要"
    applied_to: "次回の監査では、パイロットプロジェクトの特定を最優先事項に"

  - lesson: "複数の測定ツールがある場合、値の整合性を確認する必要がある"
    related_issue: "ISS-NEW-004"
    context: "coverage.json と pytest report の値が異なることに気づくのが遅れた"
    applied_to: "今後の監査では、測定値のクロスチェックを標準手順に追加"

  - lesson: "ドキュメントと実装の不一致は、技術的負債として早期是正すべき"
    related_issue: "ISS-NEW-003"
    context: "SYSTEM_CONSTITUTION.md の構造と実際のディレクトリ構造が異なる"
    applied_to: "優先度は低いが、認識は必要"

next_cycle_priority:
  priority_1:
    issue: "ISS-NEW-004"
    reason: "テストカバレッジの測定値が信頼できないため、品質評価全体の妥当性に関わる"
    gap: "GAP-006"
    estimated_effort: "2-4 hours"

  priority_2:
    issue: "ISS-NEW-002"
    reason: "パイロットプロジェクトが不明では、フィードバック収集も利用実績の検証も不可能"
    gap: "GAP-002, GAP-005"
    requires: "human input"
    estimated_effort: "1-4 hours (人間の回答次第)"

  priority_3:
    issue: "ISS-NEW-001"
    reason: "ISS-NEW-002 の解決後に、レビューデータ収集プロセスを確認"
    gap: "GAP-001, GAP-004"
    depends_on: "ISS-NEW-002"
    estimated_effort: "2-4 hours"

  priority_4:
    gap: "GAP-003"
    reason: "データ収集完了後にテレメトリー可視化を実施"
    depends_on: "ISS-NEW-001"
    estimated_effort: "4-8 hours"

metadata:
  analysis_version: "2.0"
  confidence_level: "medium-high"
  critical_path:
    - "ISS-NEW-004 解決 (テストカバレッジ測定値の信頼性回復)"
    - "ISS-NEW-002 解決 (パイロットプロジェクトの特定 - 人間の入力必要)"
    - "ISS-NEW-001 解決 (レビューデータ収集の確認)"
    - "GAP-001 完了 (ベースライン値の算出)"
    - "GAP-002 完了 (フィードバック収集)"
