# Gap Analysis Report
# Generated: 2026-01-31T21:45:00Z

version: "1.0"
run_id: "2026-01-31T21:15:00Z"

# === Summary ===
summary:
  total_gaps: 7
  critical: 1
  high: 3
  medium: 2
  low: 1
  overall_compliance: 85%

# === Detected Gaps ===
gaps:
  - gap_id: "ISS-001"
    severity: "critical"
    category: "documentation"
    title: "README.md documents only 6 of 13 actions"
    description: |
      README.md:6-17 lists 6 main actions (review-and-merge, spec-to-code, action-fixer, auto-refactor, auto-document, release-notes-ai)
      However, the actions/ directory contains 13 actions total.
      The 7 undocumented actions are: auto-merge, auto-rebase, bulk-merge-prs, bulk-rebase-prs, pr-review-enqueuer, publish-pr, review-auto-merge
    evidence:
      - "C-008: README.md documents 6 main actions"
      - "C-001: 13 actions exist in actions/ directory"
      - "C-011: 7 additional actions exist beyond the 6 main actions"
    impact: |
      Users cannot discover available actions from README
      May indicate incomplete project or internal-only actions
      Violates visibility principle for a hub repository
    intent_violation:
      field: "mission.provided_value"
      expected: "All provided actions are documented and discoverable"
      actual: "Only 46% (6/13) of actions are documented in README"
    assumption_dependency: "ASM-001 (target user needs to discover all available actions)"

  - gap_id: "ISS-002"
    severity: "high"
    category: "structure"
    title: "6 actions lack templates/ directories"
    description: |
      AGENTS.md strongly recommends externalizing prompts to templates/
      6 of 13 actions do not have templates/ directories:
      - auto-merge
      - bulk-merge-prs
      - bulk-rebase-prs
      - pr-review-enqueuer
      - publish-pr
      - review-auto-merge
    evidence:
      - "C-005: 9 out of 13 actions have templates/ directories"
      - "C-006: 4 actions do not use templates"
      - "AGENTS.md:98-109 (template extraction guidelines)"
    impact: |
      Reduced maintainability (prompts hardcoded in action.yml)
      Reduced customization (users cannot provide custom templates)
      May violate best practices if prompts exist but are not externalized
    intent_violation:
      field: "quality_attributes.structure"
      expected: "Templates must be externalized (no hardcoding in action.yml)"
      actual: "6 actions (46%) lack templates/ directories"
    assumption_dependency: "ASM-003 (3-component set includes templates/)"
    note: "Assumption J-004: These may be legitimate utility actions that don't need prompts (medium confidence)"

  - gap_id: "ISS-003"
    severity: "high"
    category: "verification"
    title: "No automated verification that actions actually function"
    description: |
      test-all-actions.yml only validates structure and YAML syntax
      Does NOT verify that:
      - Actions can execute without errors
      - Templates can be properly substituted
      - Claude CLI integration works
      - Actions produce expected outputs
    evidence:
      - "C-010: test-all-actions.yml provides dry-run validation"
      - "AGENTS.md:278-335 (Dry Run testing section)"
      - "Review of test-all-actions.yml shows only structure checks"
    impact: |
      Broken actions may pass CI
      Template substitution errors may reach production
      Claude CLI integration issues may not be caught
    intent_violation:
      field: "quality_attributes.testing"
      expected: "Dry Run mode validates actual execution flow"
      actual: "Only validates file existence and YAML syntax"

  - gap_id: "ISS-004"
    severity: "high"
    category: "quality"
    title: "Unknown test coverage for Python helper scripts"
    description: |
      Repository contains Python scripts in .claude/skills/ and tests/
      However, actual coverage percentage is unknown
      No coverage thresholds defined
    evidence:
      - "C-014: Actual test coverage percentage is unknown"
      - "pytest.ini exists with pytest-cov commented out"
      - "tests/ directory exists with test_review_and_merge/ and test_spec_to_code/"
    impact: |
      Cannot assess code quality of helper scripts
      May have untested critical paths
      Cannot measure improvement over time
    intent_violation:
      field: "quality_attributes"
      expected: "Quality should be measurable"
      actual: "No coverage metrics available"

  - gap_id: "ISS-005"
    severity: "medium"
    category: "completeness"
    title: "Core function verification tests do not exist"
    description: |
      Per instruction section 4, core functions must be verifiable
      However, no verification tests exist for the 6 core functions
      Need to create tests that prove claims like "AIがコードをレビューし自動マージできる"
    evidence:
      - "intent.yml core_functions CF-001 through CF-006"
      - "Missing: .audit/verification/verify_core_functions.py"
      - "tests/ only contains unit tests for 2 actions"
    impact: |
      Cannot prove repository fulfills its purpose
      Success conditions are not objectively verifiable
      Cannot detect regressions in core functionality
    intent_violation:
      field: "core_functions"
      expected: "All core functions are testable and tested"
      actual: "Core functions are defined but not verified"

  - gap_id: "ISS-006"
    severity: "medium"
    category: "adoption"
    title: "Adoption metrics missing (success condition unmeasurable)"
    description: |
      PURPOSE.md defines success: "組織内の複数のリポジトリでこれらのActionsが採用される"
      However, no metrics exist to measure adoption
    evidence:
      - "C-015: Number of repositories using actions is unknown"
      - "PURPOSE.md lines 69-71 (success conditions)"
    impact: |
      Cannot determine if project is successful
      Cannot prioritize improvements based on actual usage
      Success condition is unmeasurable
    intent_violation:
      field: "mission.desired_state"
      expected: "Measurable progress toward success"
      actual: "Success defined but not measured"

  - gap_id: "ISS-007"
    severity: "low"
    category: "maintenance"
    title: "Possible duplicate or typo: bulk-merge-prs vs bulk-rebase-prs"
    description: |
      Two actions exist with very similar names:
      - bulk-merge-prs
      - bulk-rebase-prs
      This is likely intentional (merge vs rebase), but worth verifying
    evidence:
      - "actions/ directory listing"
      - "README.md does not document either action"
    impact: |
      Potential naming confusion
      May indicate accidental duplication
    intent_violation:
      field: "non_goals"
      expected: "Clear naming and purpose for each action"
      actual: "Similar names may cause confusion"
    note: "Low severity - merge and rebase are different operations, likely intentional"

# === Compliance Score ===
compliance_breakdown:
  structure_compliance: 100%  # All actions have 3-component set
  documentation_compliance: 46% # Only 6/13 documented in README
  template_compliance: 69%     # 9/13 have templates/
  syntax_compliance: 100%      # All YAML files valid
  testing_coverage: unknown    # No coverage metrics
  functional_testing: 0%       # No core function verification tests

# === Prioritized Issues ===
priority_ordering:
  - priority: 1
    gap_id: "ISS-001"
    reason: "Critical visibility issue - users cannot discover available actions"
    effort: "Low (documentation update)"
    impact: "High (improves discoverability)"

  - priority: 2
    gap_id: "ISS-003"
    reason: "High risk of broken actions in production"
    effort: "Medium (requires test infrastructure)"
    impact: "High (prevents production issues)"

  - priority: 3
    gap_id: "ISS-005"
    reason: "Required by audit instruction - core function verification"
    effort: "Medium (requires creating verification tests)"
    impact: "High (proves repository purpose)"

  - priority: 4
    gap_id: "ISS-002"
    reason: "Maintainability and customization issue"
    effort: "Low-Medium (depending on action complexity)"
    impact: "Medium (improves maintainability)"

  - priority: 5
    gap_id: "ISS-004"
    reason: "Quality measurement gap"
    effort: "Low (enable coverage reporting)"
    impact: "Medium (provides quality metrics)"

  - priority: 6
    gap_id: "ISS-006"
    reason: "Success condition unmeasurable"
    effort: "High (requires cross-repo monitoring)"
    impact: "Low-Medium (strategic importance)"

  - priority: 7
    gap_id: "ISS-007"
    reason: "Potential naming confusion"
    effort: "Low (verification only)"
    impact: "Low (likely correct as-is)"
