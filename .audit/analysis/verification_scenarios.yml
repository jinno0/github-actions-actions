# Verification Scenarios for Core Functions
# Generated by Repo Genesis Auditor v2.0

scenarios:
  # === CF-001: AI Code Review & Auto-Merge ===
  - function_id: "CF-001"
    name: "review-and-merge基本動作検証"
    priority: "high"

    input:
      type: "mock_data"
      description: "模擬PRデータ（diffとファイル構造）"
      data_source: "tests/conftest.py:sample_pr_diff"

    expected_output:
      type: "json"
      description: "レビュー結果JSON（verdict: 'approve' or 'reject'）"
      validation_rules:
        - "verdictフィールドが存在"
        - "reasonフィールドが空でない"
        - "verdictがapprove/rejectのいずれか"

    edge_cases:
      - name: "空のdiff"
        input: {"diff": ""}
        expected: "verdict: reject（変更なしとして検知）"
      - name: "大規模なdiff（1000行以上）"
        input: {"diff": "large_diff_placeholder"}
        expected: "適切に処理（エラーにならない）"

    verification_method: "Dry Run（既存pytestでカバー）"

  # === CF-002: Spec-to-Code Generation ===
  - function_id: "CF-002"
    name: "spec-to-code生成検証"
    priority: "high"

    input:
      type: "markdown_file"
      description: "Markdown形式の仕様書"
      sample_content: |
        # 仕様: ユーザー認証機能
        ## 要件
        - メールアドレスとパスワードで認証
        - JWTトークンを返却

    expected_output:
      type: "code"
      description: "生成されたコードファイル"
      validation_rules:
        - "指定された言語で出力"
        - "仕様の要件を実装"
        - "構文的に正しいコード"

    edge_cases:
      - name: "空の仕様書"
        input: "# Empty spec"
        expected: "エラーまたは空の出力"
      - name: "矛盾する要件"
        input: "# Contradictory spec\n## A: true\n## A: false"
        expected: "適切なエラーハンドリング"

    verification_method: "構造チェック（テンプレートとYAML検証）"

  # === CF-003: Action-Fixer Auto-Repair ===
  - function_id: "CF-003"
    name: "action-fixerエラー検知・修正"
    priority: "medium"

    input:
      type: "yaml_file"
      description: "構文エラーを含むworkflowファイル"
      sample_content: |
        name: Broken Workflow
        on: [push]
        jobs:
          build:
            runs-on: ubuntu-latest
            steps:
              - uses: actions/checkout@v3
              # インデントエラー
            run: echo "test"

    expected_output:
      type: "yaml_patch"
      description: "修正パッチまたは修正済みYAML"
      validation_rules:
        - "YAML構文が有効"
        - "元の意図を保持"

    edge_cases:
      - name: "複数のエラー"
        input: "errors_in_multiple_places"
        expected: "全てのエラーを検知"
      - name: "修復不可能なエラー"
        input: "completely_broken_yaml"
        expected: "適切なエラーメッセージ"

    verification_method: "Dry Run（既存pytestでカバー）"

  # === CF-004: Dry Run Verification ===
  - function_id: "CF-004"
    name: "全アクションのDry Run検証"
    priority: "critical"

    input:
      type: "directory_scan"
      description: "actions/ディレクトリ以下の全アクション"
      scan_target: "actions/*/action.yml"

    expected_output:
      type: "test_result"
      description: "pytest実行結果"
      validation_rules:
        - "全テストがパス"
        - "構造チェックが成功"
        - "YAML構文が有効"

    edge_cases:
      - name: "action.ymlが存在しないアクション"
        input: "incomplete_action_directory"
        expected: "テスト失敗で検知"
      - name: "テンプレートファイルが欠落"
        input: "action_without_templates"
        expected: "テスト失敗で検知"

    verification_method: "pytest --cov=. tests/"

# === Summary ===
summary:
  total_scenarios: 4
  high_priority: 2
  medium_priority: 1
  critical_priority: 1
  mock_based: 3
  structural: 1
