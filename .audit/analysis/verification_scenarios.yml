version: "2.0"
run_id: "run-2026-02-07T17:52:36Z"
generated_at: "2026-02-07T17:52:36Z"

# === Core Function Verification Scenarios ===
# Based on intent.yml core_functions (CF-001 through CF-010)

scenarios:
  # === CF-001: review-and-merge ===
  - function_id: "CF-001"
    name: "AIレビューと自動マージ (review-and-merge)"
    source: "README.md:14"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/review-and-merge/action.yml"
      validation:
        - "required: name, description, runs"
        - "required: steps using actions/checkout"
        - "Claude Code CLIの呼び出しが存在"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "action.ymlの必須フィールドが全て存在"
        - "Claude Code CLIを実行するstepが定義されている"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_review_and_merge"
      description: "pytestでaction.ymlの構造と必須要素を検証"

    edge_cases:
      - name: "Missing Claude Code CLI step"
        expectation: "検証失敗 - Core Functionとしての役割を果たせない"
      - name: "Invalid YAML syntax"
        expectation: "検証失敗 - YAMLパースエラー"

  # === CF-002: spec-to-code ===
  - function_id: "CF-002"
    name: "仕様書からのコード自動生成 (spec-to-code)"
    source: "README.md:15"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/spec-to-code/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "inputsにspec_pathまたは類似の入力が存在"
        - "Claude Code CLIを実行するstepが定義されている"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_spec_to_code"

  # === CF-003: action-fixer ===
  - function_id: "CF-003"
    name: "WorkflowエラーのAI自動修正 (action-fixer)"
    source: "README.md:16"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/action-fixer/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "failed_workflowを入力として受け取る"
        - "Claude Code CLIで修正を生成するstepがある"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_action_fixer"

  # === CF-004: auto-refactor ===
  - function_id: "CF-004"
    name: "自然言語指示に基づくリファクタリング (auto-refactor)"
    source: "README.md:17"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/auto-refactor/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "refactoring_instructionsを入力として受け取る"
        - "Claude Code CLIでリファクタリングを実行する"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_auto_refactor"

  # === CF-005: auto-document ===
  - function_id: "CF-005"
    name: "ドキュメント自動更新 (auto-document)"
    source: "README.md:23"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/auto-document/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "ドキュメント生成のためのstepが存在"
        - "Claude Code CLIを活用している"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_auto_document"

  # === CF-006: release-notes-ai ===
  - function_id: "CF-006"
    name: "AIリリースノート生成 (release-notes-ai)"
    source: "README.md:24"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証"
      path: "actions/release-notes-ai/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "コミット履歴からリリースノートを生成する"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_release_notes_ai"

  # === CF-007: auto-merge & review-auto-merge ===
  - function_id: "CF-007"
    name: "PRの自動マージ (auto-merge, review-auto-merge)"
    source: "README.md:30-32"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証（2つのアクション）"
      paths:
        - "actions/auto-merge/action.yml"
        - "actions/review-auto-merge/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "両方のYAMLがパース可能"
        - "PRをマージするstepが存在"
        - "条件チェック（CIパスなど）がある"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_auto_merge"

  # === CF-008: bulk-merge-prs & bulk-rebase-prs ===
  - function_id: "CF-008"
    name: "一括PR操作 (bulk-merge-prs, bulk-rebase-prs)"
    source: "README.md:39-40"

    input:
      type: "structural_test"
      description: "action.ymlの構造検証（2つのアクション）"
      paths:
        - "actions/bulk-merge-prs/action.yml"
        - "actions/bulk-rebase-prs/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "両方のYAMLがパース可能"
        - "複数のPRを操作するループ処理がある"

    verification_method:
      type: "pytest"
      test_path: "tests/test_actions.py"
      test_pattern: "test_bulk_operations"

  # === CF-009: custom-review-rules ===
  - function_id: "CF-009"
    name: "カスタムレビュールール注入"
    source: "README.md:66-76"

    input:
      type: "structural_test"
      description: "review-and-mergeのカスタムルール機能"
      path: "actions/review-and-merge/action.yml"

    expected_output:
      type: "yaml_structure"
      criteria:
        - "YAMLとしてパース可能"
        - "custom_rulesを入力として受け取る"
        - "またはinstructions/review-and-merge-custom-rules.mdが存在"

    verification_method:
      type: "documentation_test"
      documentation_path: "instructions/review-and-merge-custom-rules.md"
      criteria:
        - "ドキュメントが存在する"
        - "カスタムルールの注入方法が説明されている"

  # === CF-010: dry-run ===
  - function_id: "CF-010"
    name: "Dry Run検証（構造チェック・YAML構文・モック実行）"
    source: "README.md:94"

    input:
      type: "functional_test"
      description: "Dry Runモードでの実行"
      workflow_path: ".github/workflows/test-with-dry-run.yml"

    expected_output:
      type: "execution_result"
      criteria:
        - "全Actionsがdry-runでエラーなし"
        - "各Actionの構造が検証される"
        - "モック実行が成功する"

    verification_method:
      type: "pytest"
      test_path: "tests/"
      test_pattern: "dry_run"
      description: "pytest -k dry_run で全Actionsのdry-runを検証"

    edge_cases:
      - name: "Actionに構造エラーがある"
        expectation: "dry-runで失敗し、エラーが報告される"
      - name: "依存関係が不足している"
        expectation: "dry-runで検出され、不足が報告される"

# === Verification Strategy ===
verification_strategy:
  approach: "structural_and_functional"
  rationale: |
    AI Actionsは実際にClaude Code CLI環境がないと完全な機能テストが不可能。
    したがって、以下の多層的なアプローチを採用する:

    1. 構造検証 (Structural Tests)
       - action.ymlがYAMLとしてパース可能
       - 必須フィールドの存在確認
       - Claude Code CLIを呼び出すstepの存在確認

    2. ドキュメント検証 (Documentation Tests)
       - 各Actionに対応するInstructionが存在
       - Exampleが存在
       - セットアップガイドが完成している

    3. Dry Run検証 (Functional Tests)
       - 全Actionsがdry-runモードで実行可能
       - モック実行でクラッシュしない

  limitations:
    - "実際のAI処理結果の品質検証はできない（Claude環境依存）"
    - "本番実行時のパフォーマンス検証はできない"
    - "AI生成コードの正確性検証はできない"

  mitigation:
    - "構造検証で最低限の動作保証をする"
    - "Dry Runで明らかな設定ミスを検出する"
    - "ドキュメントの充実度で品質を推測する"
