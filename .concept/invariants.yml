updated_at: "2026-01-18T12:46:40Z"
invariants:
  - id: "INV-001"
    related_terms: ["CompositeAction"]
    status: "stable"
    strength: "hard"
    statement: "Docker container actionsとJavaScript actionsは除外し、Composite Actionsのみに焦点を当てる"
    rationale: "プロジェクトのスコープを明確にし、責務をgithub-actions-templatesと分離するため"
    assumptions: []
    evidence:
      - source: "SYSTEM_CONSTITUTION.md#L19-L23"
        quote: "Docker container actions, JavaScript actions は含まない。Composite Actions のみに焦点を当てる。"
    checks:
      - type: "manual"
        target: "actions/*/action.yml"

  - id: "INV-002"
    related_terms: ["SingleResponsibility"]
    status: "stable"
    strength: "hard"
    statement: "各Actionは1つの明確な目的のみを持たなければならない（setup+test+deploy等の複数責務禁止）"
    rationale: "再利用性と保守性を確保するため"
    assumptions: []
    evidence:
      - source: "SYSTEM_CONSTITUTION.md#L35-L40"
        quote: "各 Action は**1つの明確な目的**のみを果たす。❌ 複数の責務を持たない（例: セットアップ＋テスト＋デプロイ）"
    checks:
      - type: "manual"
        target: "actions/*/action.yml"

  - id: "INV-003"
    related_terms: ["OrganizationWideReusability"]
    status: "stable"
    strength: "hard"
    statement: "全Actionは組織内のどのリポジトリからでも使用可能でなければならない"
    rationale: "組織横断的再利用性という核心的な使命を満たすため"
    assumptions: []
    evidence:
      - source: "SYSTEM_CONSTITUTION.md#L80-L85"
        quote: "すべての Action は**組織内のどのリポジトリからでも**使用可能である必要がある。"
    checks:
      - type: "manual"
        target: "actions/*/action.yml"

  - id: "INV-004"
    related_terms: ["VersionPinning"]
    status: "stable"
    strength: "hard"
    statement: "Actionのバージョン管理はタグ（v1, v2）で行い、@main参照を禁止する"
    rationale: "安定性を確保し、予期せぬ破壊的変更を防ぐため"
    assumptions: []
    evidence:
      - source: "SYSTEM_CONSTITUTION.md#L95-L100"
        quote: "タグ (v1, v2) でバージョンを管理。@main は使用しない（安定性のため）。"
    checks:
      - type: "grep"
        target: "examples/*.yml"
        pattern: "@main"

  - id: "INV-005"
    related_terms: ["StandardActionStructure"]
    status: "stable"
    strength: "hard"
    statement: "全Actionは3つの構成要素（action.yml, example, instruction）を持たなければならない"
    rationale: "開発者と利用者の双方がスムーズに利用できるようにするため"
    assumptions: []
    evidence:
      - source: "AGENTS.md#L165-L175"
        quote: "新しい Action を作成または既存の Action を整備する際は、必ず以下の3つの構成要素をセットで用意してください。"
    checks:
      - type: "manual"
        target: "actions/*"

  - id: "INV-006"
    related_terms: ["TemplateFile"]
    status: "stable"
    strength: "soft"
    statement: "プロンプトや通知メッセージはaction.ymlにハードコーディングせず、templates/ディレクトリのファイルから読み込むべきである"
    rationale: "メンテナンス性とカスタマイズ性を向上させるため"
    assumptions: []
    evidence:
      - source: "AGENTS.md#L15-L25"
        quote: "action.yml 内にプロンプトや文章をハードコーディングするのではなく、テンプレートファイルとして切り出します。"
    checks:
      - type: "manual"
        target: "actions/*/action.yml"

  - id: "INV-007"
    related_terms: ["AutoFix"]
    status: "draft"
    strength: "soft"
    statement: "auto-fix成功時はconfidence=10としてLGTM扱いする（暫定仕様）"
    rationale: "自動修正で問題が解決された場合、再レビューの不要性を仮定"
    assumptions:
      - id: "ASM-AUTO-FIX-001"
        text: "AUTO: auto-fix成功時はconfidence=10としてLGTM扱い"
        decision_key: "AUTO:AutoFix.lgtm_on_success"
        expires_after_runs: 20
    evidence:
      - source: "actions/review-and-merge/action.yml#L110-L115"
        quote: "In auto-fix mode, we assume LGTM if execution succeeded"
    checks:
      - type: "test"
        target: "actions/review-and-merge/"

  - id: "INV-008"
    related_terms: ["ConflictResolution"]
    status: "draft"
    strength: "soft"
    statement: "rebase中の競合解決はbase branch version（theirs）を優先する（暫定仕様）"
    rationale: "保守的なアプローチで誤修正を防ぐため"
    assumptions:
      - id: "ASM-CONFLICT-001"
        text: "AUTO: 競合解決はtheirs（base branch）を採用"
        decision_key: "AUTO:ConflictResolution.theirs_priority"
        expires_after_runs: 20
    evidence:
      - source: "actions/review-and-merge/action.yml#L210-L215"
        quote: "Resolve conflicts by accepting the base branch version (conservative)"
    checks:
      - type: "test"
        target: "actions/review-and-merge/"
  - id: "INV-STD-STRUCT-003"
    related_terms: ["StandardActionStructure", "PublishPrAction", "AutoMergeAction"]
    status: "draft"
    strength: "hard"
    statement: "新しいAction（publish-pr, auto-merge）はStandard Action Structureに違反している（examples/instructionsが欠如）"
    rationale: "AGENTS.md#L165-L175のinvariant違反"
    assumptions:
      - id: "ASM-INV-STD-003"
        text: "AUTO: 違反をhigh severityとして扱い、是正アクションを要求"
        decision_key: "AUTO:StandardActionStructure.enforcement"
        expires_after_runs: 10
    evidence:
      - source: "examples/"
        quote: "publish-pr-example.yml and auto-merge-example.yml are missing"
      - source: "instructions/"
        quote: "publish-pr.md and auto-merge.md are missing"
    checks:
      - type: "manual"
        target: "examples/publish-pr-example.yml, examples/auto-merge-example.yml, instructions/publish-pr.md, instructions/auto-merge.md"
