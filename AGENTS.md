# AGENTS.md - AIエージェントへの指示

このファイルは、AIエージェント（Claude Code等）がこのリポジトリで作業する際に最初に読むべき指示です。

## 自動埋め込み仕組み（重要）

AIエージェントは、タスク実行時に**最新のプロジェクト情報が自動的にプロンプトに埋め込まれます**：

### 埋め込まれる情報

1. **PURPOSE.mdの最新セクション**（現在のステータス、最大50行）
   - 「現在のステータス」セクションを自動抽出
   - プロジェクトの現在のフェーズ・優先順位を把握

2. **TASKS.mdの最新N行**（最新50行）
   - 今日〜今週のTODO・メモを自動抽出
   - 現在の作業コンテキストを把握

3. **仕組み**: `tools/harness/run_task.py` が実行時に読み込んでプロンプトに埋め込みます

### メリット

- ✅ **プロンプト肥大化防止**: 全文ではなく「必要な部分だけ」埋め込み
- ✅ **常に最新情報**: 実行時に動的に読み込むので、古い情報を見る心配がない
- ✅ **WORKTREE問題解決**: TASKS.mdがworktreeにない場合でも、内容を伝達可能
- ✅ **スリム化**: 過去の情報は埋め込まず、現在の情報だけに集中

## 必読ファイル（この順で読むこと）

自動埋め込みに加えて、以下のファイルも直接読んでください。

### 1. PURPOSE.md（必須・全文）

- **内容**: このプロジェクトの大目標・非目標・成功条件・今期の優先順位
- **目的**: プロジェクトの全体像と方向性を理解する（プロンプトには最新セクションのみ埋め込み）
- **更新頻度**: 低（月に1回〜数ヶ月に1回）
- **位置**: リポジトリルート

### 2. TASKS.md（推奨・全文）

- **内容**: 今日〜今週の細かいToDo・メモ・コマンド履歴
- **目的**: 現在の作業コンテキストと優先順位を理解する（プロンプトには最新50行のみ埋め込み）
- **注意**: 存在しない場合は無視してOK（ローカルファイル）
- **更新頻度**: 高（毎日〜毎週）
- **位置**: リポジトリルート（.gitignore済み）

### 3. SYSTEM_CONSTITUTION.md（必須）

- **内容**: Layer0: 憲法（変更不可の絶対ルール）
- **目的**: 何が禁止されているか、何が必須かを理解する
- **更新頻度**: 極低（基本的に不変）

### 4. hub/runtime.yml（必須）

- **内容**: 実行設定（時間上限、テストコマンド）
- **目的**: 実行時の制約を理解する

### 5. hub/policy/policy.current.md（必須）

- **内容**: コーディング方針（進化対象）
- **目的**: どの順序で作業するか、何を優先するかを理解する
- **更新頻度**: 中（評価結果に基づいて更新）

### 6. README.md（推奨）

## 読み込み時の注意点

1. **PURPOSE.mdを最優先**: このプロジェクトの「なぜ」「何を」「どう」を理解する
2. **TASKS.mdは補助**: 現在の優先順位を把握するだけ（詳細はPURPOSE.mdを参照）
3. **憲法は絶対**: SYSTEM_CONSTITUTION.md のルールは破ってはならない

## タスク実行時のワークフロー

AIエージェントがタスクを実行する際は、以下の手順を守ってください：

1. **コンテキスト理解**
   - PURPOSE.md を読む（大目標・今期の優先順位）
   - TASKS.md を読む（現在のTODO・制約）
   - SYSTEM_CONSTITUTION.md を読む（絶対ルール）

2. **方針決定**
   - hub/policy/policy.current.md を参照
   - 「テスト優先か実装優先か」「どこから触るか」を決定

3. **実行**
   - hub/templates/prompt_task.md に従って作業
   - 最小差分で変更を加える

4. **検証**
   - テストを実行
   - 変更内容を要約

5. **出力**
   - Summary, Decision trace, Files changed, Test result を記録

## 人間へのフィードバック

AIエージェントは以下の場合に人間に報告してください：

- PURPOSE.md に矛盾するタスクが与えられた場合
- TASKS.md に記載された制約とタスクが競合する場合
- SYSTEM_CONSTITUTION.md に違反する変更を求められた場合

## 自己更新ループ（将来）

TBD
将来的には、AIエージェントが自身で PURPOSE.md や POLICY.md を更新する仕組みを導入予定です。
